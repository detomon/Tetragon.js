!function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),function(a){"use strict";a.Tetragon=a.Tetragon||{}}(window),function(){"use strict";var a=Tetragon.Vector=function(a,b){this.x=parseFloat(a)||0,this.y=parseFloat(b)||0};a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.sub=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.inc=function(a){this.x+=a.x,this.y+=a.y},a.prototype.dec=function(a){this.x-=a.x,this.y-=a.y},a.prototype.shl=function(b){return new a(this.x<<b,this.y<<b)},a.prototype.shr=function(b){return new a(this.x>>b,this.y>>b)},a.prototype.integ=function(b){return new a(0|this.x,0|this.y)},a.prototype.mult=function(b){return new a(this.x*b,this.y*b)},a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.normalize=function(b){void 0===b&&(b=1);var c=this.x,d=this.y,e=this.length();return e&&(e=b/e),c*=e,d*=e,new a(c,d)},a.prototype.multVec=function(b){return new a(this.x*b.x,this.y*b.y)},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.reflect=function(a){return a=a.normalize(),this.sub(a.mult(2*a.dot(this)))},a.prototype.negate=function(b){return new a(-this.x,-this.y)},a.prototype.copy=function(){return new a(this.x,this.y)},a.prototype.rotate=function(b){var c=b/180*Math.PI,d=Math.cos(c),e=Math.sin(c),f=this.x*d-this.y*e,g=this.x*e+this.y*d;return new a(f,g)},a.prototype.copy=function(b){return new a(this.x,this.y)}}(),function(){"use strict";var a=Tetragon.AnimationLoop=function(a){this.framerate=a,this.lastTime=0};a.prototype.advanceToTime=function(a,b){for(0==this.lastTime&&(this.lastTime=a-1/60),this.lastTime=Math.max(a-.05,this.lastTime),a-=this.framerate;this.lastTime<a;)b(this.framerate),this.lastTime+=this.framerate}}(),function(){"use strict";var a=Tetragon.Controls=function(){this.keys=0};a.LEFT=1,a.TOP=2,a.RIGHT=4,a.BOTTOM=8,a.keyMap={37:a.LEFT,38:a.TOP,39:a.RIGHT,40:a.BOTTOM,65:a.LEFT,87:a.TOP,68:a.RIGHT,83:a.BOTTOM},a.prototype.pressKeyWithCode=function(b){a.keyMap[b]&&(this.keys|=a.keyMap[b])},a.prototype.releaseKeyWithCode=function(b){a.keyMap[b]&&(this.keys&=~a.keyMap[b])},a.prototype.isKeyPressed=function(a){return this.keys&a},a.prototype.reset=function(){this.keys=0}}(),function(){"use strict";var a=Tetragon.EntitySystem=function(){this.entities=[],this.freeEntites=[],this.components=[],this.namedComponents={}};a.prototype.component=function(a){return this.namedComponents[a]},a.prototype.createComponent=function(a){var b=this.components.length,d=new c(b,a);return this.components.push(d),this.namedComponents[d.name]=d,d},a.prototype.entity=function(a){return void 0===this.entities[a]?null:new b(a,this)},a.prototype.createEntity=function(){var a=this.freeEntites.pop();return void 0===a&&(a=this.entities.length+1,this.entities.push(0)),new b(a,this)},a.prototype.iterate=function(a,b){var c=Array.prototype.slice.apply(arguments,[2]),d=this.component(a);d&&(c.unshift(b),d.iterate.apply(d,c))};var b=Tetragon.Entity=function(a,b){this.id=a,this.system=b};b.prototype.addComponent=function(a){var b=Array.prototype.slice.apply(arguments,[1]);if("string"==typeof a&&(a=this.system.component(a),!a))return null;if(a.data[this.id-1])return null;var c;return c=a.createInstance?a.createInstance.apply(this,b):{},c.entity=this,a.data[this.id-1]=c,this.system.entities[this.id-1]|=1<<a.id,c},b.prototype.removeComponent=function(a){return("string"!=typeof a||(a=this.system.component(a)))&&a.data[this.id-1]?(delete a.data[this.id-1],this.system.entities[this.id-1]&=~(1<<a.id),instance):null},b.prototype.componentData=function(a){var b=this.system.namedComponents[a];return b?b.data[this.id-1]:null},b.prototype["delete"]=function(){var a=0,b=this.system;if(void 0!==b.entities[this.id-1]){for(var c=b.entities[this.id-1];c;){if(255&c||(c>>=8,a+=8),1&c){var d=b.components[a];delete d.data[this.id-1]}c>>=1,a++}delete b.entities[this.id-1],b.freeEntites.push(this.id)}};var c=Tetragon.EntityComponent=function(a,b){this.id=a,this.name=b.name,this.options=b,this.createInstance=b.createInstance,this.data=[]};c.prototype.iterate=function(a){var b,c=Array.prototype.slice.apply(arguments,[1]);if("function"==typeof a)for(b in this.data)this.data.hasOwnProperty(b)&&a.apply(this.data[b],c);else{if(a=this.options[a],!a)return;for(b in this.data)this.data.hasOwnProperty(b)&&a.apply(this.data[b],c)}}}(),function(){"use strict";var a=Tetragon.Matrix=function(a){if(a)for(var b=0;6>b;b++)this[b]=a[b];else this[0]=1,this[1]=0,this[2]=0,this[3]=1,this[4]=0,this[5]=0};a.prototype.translate=function(a){this[4]+=a.x*this[0]+a.y*this[2],this[5]+=a.x*this[1]+a.y*this[3]},a.prototype.scale=function(a){this[0]*=a.x,this[2]*=a.x,this[1]*=a.y,this[3]*=a.y},a.prototype.multVec=function(a){return new Tetragon.Vector(this[0]*a.x+this[2]*a.y+this[4],this[1]*a.x+this[3]*a.y+this[5])},a.prototype.multiply=function(b){return new a([this[0]*b[0]+this[2]*b[1],this[1]*b[0]+this[3]*b[1],this[0]*b[2]+this[2]*b[3],this[1]*b[2]+this[3]*b[3],this[0]*b[4]+this[2]*b[5]+this[4],this[1]*b[4]+this[3]*b[5]+this[5]])},a.prototype.invert=function(){var a,b=new Tetragon.Matrix;return b[0]=this[3],b[1]=-this[1],b[2]=-this[2],b[3]=this[0],b[4]=this[2]*this[5]-this[3]*this[4],b[5]=-this[0]*this[5]+this[1]*this[4],a=this[0]*b[0]+this[2]*b[1],0==a?this.copy():(a=1/a,b[0]*=a,b[1]*=a,b[2]*=a,b[3]*=a,b[4]*=a,b[5]*=a,b)},a.prototype.copy=function(){var a=new Tetragon.Matrix;return a[0]=this[0],a[1]=this[1],a[2]=this[2],a[3]=this[3],a[4]=this[4],a[5]=this[5],a},a.prototype.setContextTransform=function(a){a.setTransform(this[0],this[1],this[2],this[3],this[4],this[5])}}(),function(){"use strict";var a=Tetragon.PointMass=function(a,b){this.p=a.copy(),this.pp=a.copy(),this.a=new Tetragon.Vector,this.mass=b||1,this.damping=.997,this.pinned=!1};a.prototype.inertia=function(a){var b=.5*a*a,c=this.p.sub(this.pp).mult(this.damping),d=this.p.add(c.add(this.a.mult(b)));this.pp=this.p.copy(),this.p=d,this.a=new Tetragon.Vector},a.prototype.applyForce=function(a){this.a=this.a.add(a.mult(1/this.mass))},a.prototype.pin=function(){this.pp=this.p.copy(),this.pinned=!0}}(),function(){"use strict";var a=Tetragon.Range=function(a,b){this.start=a||0,this.length=b||0};Object.defineProperty(a.prototype,"end",{enumerable:!0,get:function(){return this.start+this.length},set:function(a){this.length=a-this.start}}),a.prototype.intersectsWithPoint=function(a){return a.x>=this.start&&a.y<=this.end},a.prototype.intersectsWithRange=function(a){return a.start<this.end&&a.end>this.start}}(),function(){"use strict";var a=Tetragon.Rect=function(a,b){this.pos=a?a.copy():new Tetragon.Vector,this.size=b?b.copy():new Tetragon.Vector};Object.defineProperty(a.prototype,"maxPos",{enumerable:!0,get:function(){return this.pos.add(this.size)},set:function(a){this.size=a.sub(this.size)}}),a.prototype.intersectsWithRect=function(a){return a.pos.x<this.pos.x+this.size.x&&a.pos.x+a.size.x>this.pos.x&&a.pos.y<this.pos.y+this.size.y&&a.pos.y+a.size.y>this.pos.y?!0:!1}}(),function(){"use strict";var a=Tetragon.Canvas=function(a){this.element=a.element,this.viewport=new Tetragon.Rect,this.ctx=a.element.getContext("2d"),this.tick=a.tick||function(){},this.draw=a.draw||function(){},this.framerate=a.framerate||1/120,this.frameDelta=0,this.animationLoop=new Tetragon.AnimationLoop(this.framerate),this.transform=new Tetragon.Matrix,this.inverseTrans=new Tetragon.Matrix,this._updateViewport()};a.prototype._updateViewport=function(){var a=this.element,b=+a.width,c=+a.height;this.viewport.size.x=b,this.viewport.size.y=c},a.prototype._tick=function(){var a=this,b=(new Date).getTime()/1e3;this._updateViewport(),this.animationLoop.advanceToTime(b,function(){a.tick(a.framerate,{viewport:a.viewport})}),this.frameDelta=(b-this.animationLoop.lastTime)/this.animationLoop.framerate,this._draw(),this.animationFrame=window.requestAnimationFrame(function(){a._tick()})},a.prototype._draw=function(){this._updateViewport();var a=this.viewport.size,b=a.x,c=a.y;this.ctx.clearRect(0,0,b,c),this.ctx.save(),this.transform=new Tetragon.Matrix,this.inverseTrans=null,this.draw(this.ctx,{viewport:this.viewport,frameDelta:this.frameDelta}),this.ctx.restore()},a.prototype.inverseTransform=function(){return this.inverseTrans||(this.inverseTrans=this.transform.invert()),this.inverseTrans},a.prototype.startAnimating=function(){var a=this;this.animationFrame||(this.animationFrame=window.requestAnimationFrame(function(){a._tick()}))},a.prototype.stopAnimating=function(){this.animationFrame&&(window.cancelAnimationFrame(this.animationFrame),this.animationFrame=null)},a.prototype.redraw=function(){this._draw()},a.prototype.offsetFromEvent=function(a){for(var b=this.element,c=b.offsetLeft,d=b.offsetTop;b=b.offsetParent;)c+=b.offsetLeft,d+=b.offsetTop;var e=new Tetragon.Vector(c,d),f=this.element.offsetWidth/this.element.width;return a.changedTouches?(e.x=a.changedTouches[0].pageX-e.x,e.y=a.changedTouches[0].pageY-e.y):(e.x=a.clientX-e.x+document.documentElement.scrollLeft,e.y=a.clientY-e.y+document.documentElement.scrollTop),e.x-=.5*this.element.offsetWidth,e.y-=.5*this.element.offsetHeight,e=e.mult(1/f)}}(),function(){"use strict";var a=Tetragon.Constraint=function(a,b,c,d){void 0===c&&(c=b.p.sub(a.p).length()),void 0===d&&(d=1),this.p1=a,this.p2=b,this.restDist=c,this.stiffness=d};a.prototype.solve=function(){var a=this.p1,b=this.p2,c=a.p.sub(b.p),d=c.length(),e=0;0!=d&&(e=(this.restDist-d)/d),c=c.mult(e);var f=1-a.mass/(a.mass+b.mass),g=f*this.stiffness,h=this.stiffness-g;a.pinned||(a.p=a.p.add(c.mult(g))),b.pinned||(b.p=b.p.sub(c.mult(h)))}}();
//# sourceMappingURL=tetragon.min.js.map