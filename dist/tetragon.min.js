!function(t){"use strict";t.Tetragon=t.Tetragon||{version:"0.1.13"}}(window),function(i){"use strict";var e=i.Tween=function(t){t=i.extend({startValue:0,endValue:0,duration:1,done:null,easeFunc:null},t),this.time=0,this.state=0,this.startValue=t.startValue,this.endValue=t.endValue,this.duration=t.duration,this.done=t.done,this.options=t},t=(e.STATE_RUNNING=1,e.STATE_ENDED=2,e.easeInQuad=function(t){return t*t},e.easeOutQuad=function(t){return-t*(t-2)},e.easeInOutQuad=function(t){return(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1)},e.easeInCubic=function(t){return t*t*t},e.easeOutCubic=function(t){return(t-=1)*t*t+1},e.easeInOutCubic=function(t){return(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},e.easeInQuart=function(t){return t*t*t*t},e.easeOutQuart=function(t){return-((t-=1)*t*t*t-1)},e.easeInOutQuart=function(t){return(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},e.easeInQuint=function(t){return t*t*t*t*t},e.easeOutQuint=function(t){return(t-=1)*t*t*t*t+1},e.easeInOutQuint=function(t){return(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},e.easeInSine=function(t){return-1*Math.cos(t*(Math.PI/2))+1},e.easeOutSine=function(t){return Math.sin(t*(Math.PI/2))},e.easeInOutSine=function(t){return-.5*(Math.cos(Math.PI*t)-1)},e.easeInExpo=function(t){return 0==t?0:+Math.pow(2,10*(t-1))},e.easeOutExpo=function(t){return 1==t?1:1-Math.pow(2,-10*t)},e.easeInOutExpo=function(t){return 0==t?0:1==t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*--t))},e.easeInCirc=function(t){return-(Math.sqrt(1-t*t)-1)},e.easeOutCirc=function(t){return Math.sqrt(1-(t-=1)*t)},e.easeInOutCirc=function(t){return(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},e.easeInElastic=function(t){var i=1.70158,e=0,n=1;return 0==t?0:1==t?1:(e=e||.3,i=n<Math.abs(1)?(n=1,e/4):e/(2*Math.PI)*Math.asin(1/n),-(n*Math.pow(2,10*--t)*Math.sin((+t-i)*(2*Math.PI)/e)))},e.easeOutElastic=function(t){var i=1.70158,e=0,n=1;return 0==t?0:1==t?1:(e=e||.3,i=n<Math.abs(1)?(n=1,e/4):e/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*t)*Math.sin((+t-i)*(2*Math.PI)/e)+1)},e.easeInOutElastic=function(t){var i=1.70158,e=0,n=1;return 0==t?0:2==(t/=.5)?1:(e=e||.3*1.5*1,i=n<Math.abs(1)?(n=1,e/4):e/(2*Math.PI)*Math.asin(1/n),t<1?n*Math.pow(2,10*--t)*Math.sin((+t-i)*(2*Math.PI)/e)*-.5:n*Math.pow(2,-10*--t)*Math.sin((+t-i)*(2*Math.PI)/e)*.5+1)},e.easeInBack=function(t,i){return t*t*(((i=null==i?1.70158:i)+1)*t-i)},e.easeOutBack=function(t,i){return(t-=1)*t*(((i=null==i?1.70158:i)+1)*t+i)+1},e.easeInOutBack=function(t,i){return null==i&&(i=1.70158),(t/=.5)<1?t*t*((1+(i*=1.525))*t-i)*.5:.5*((t-=2)*t*((1+(i*=1.525))*t+i)+2)},e.easeInBounce=function(t){return 1-e.easeOutBounce(1-t,0)},e.easeOutBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},e.easeInOutBounce=function(t){return t<.5?.5*e.easeInBounce(2*t,0):.5*e.easeOutBounce(2*t-1,0)+.5},e.prototype);Object.defineProperty(t,"value",{enumerable:!0,get:function(){var t=this.time/this.duration;return this.options.easeFunc&&(t=this.options.easeFunc(t)),this.startValue+t*(this.endValue-this.startValue)}}),t.tick=function(t){this.time=Math.min(this.time+t,this.duration),this.time,this.duration,this.time>=this.duration&&this.done&&(this.done(),this.done=null)},t.reset=function(){this.time=0}}(Tetragon),function(){"use strict";var e=Tetragon.Vector=function(t,i){e.prototype.isPrototypeOf(t)?(this.x=t.x,this.y=t.y):(this.x=parseFloat(t)||0,this.y=parseFloat(i)||0)},t=e.prototype;Object.defineProperty(t,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),Object.defineProperty(t,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y}}),Object.defineProperty(t,"negated",{get:function(){return new e(-this.x,-this.y)}}),Object.defineProperty(t,"rotation",{get:function(){var t=Math.atan2(this.y,this.x);return(t=t<0?t+2*Math.PI:t)/Math.PI*180}}),Object.defineProperty(t,"integ",{get:function(){return new e(Math.floor(this.x),Math.floor(this.y))}}),t.add=function(t){return new e(this.x+t.x,this.y+t.y)},t.sub=function(t){return new e(this.x-t.x,this.y-t.y)},t.mult=function(t){return t===Object(t)?new e(this.x*t.x,this.y*t.y):new e(this.x*t,this.y*t)},t.div=function(t){return t===Object(t)?new e(this.x/t.x,this.y/t.y):new e(this.x/t,this.y/t)},t.normalize=function(t){void 0===t&&(t=1);var i=(i=this.length)&&t/i;return new e(this.x*i,this.y*i)},t.dot=function(t){return this.x*t.x+this.y*t.y},t.rotate=function(t){var t=t/180*Math.PI,i=Math.cos(t),t=Math.sin(t);return new e(this.x*i-this.y*t,this.x*t+this.y*i)},t.reflect=function(t,i){return i=void 0===i?1:.5+.5*i,t=t.normalize(),t=this.sub(t.mult(2*t.dot(this)).mult(i)),t=2!=i?t.normalize(this.length):t},t.inc=function(t){this.x+=t.x,this.y+=t.y},t.dec=function(t){this.x-=t.x,this.y-=t.y},t.shl=function(t){return new e(this.x<<t,this.y<<t)},t.shr=function(t){return new e(this.x>>t,this.y>>t)},t.copy=function(t){return new e(this.x,this.y)}}(),function(){"use strict";var t=(Tetragon.AnimationLoop=function(t){this.framerate=t,this.lastTime=0}).prototype;t.advanceToTime=function(t,i){for(0==this.lastTime&&(this.lastTime=t-1/60),this.lastTime=Math.max(t-.05,this.lastTime),t-=this.framerate;this.lastTime<t;)i(this.framerate),this.lastTime+=this.framerate},t.reset=function(){this.lastTime=0}}(),function(){"use strict";(Tetragon.Constraint=function(t,i,e,n){void 0===e&&(e=i.p.sub(t.p).length),void 0===n&&(n=1),this.p1=t,this.p2=i,this.restDist=e,this.stiffness=n}).prototype.solve=function(){var t=this.p1,i=this.p2,e=(s=t.p.sub(i.p)).length,n=0,s=(0!=e&&(n=(this.restDist-e)/e),s.mult(n)),e=(1-t.mass/(t.mass+i.mass))*this.stiffness,n=this.stiffness-e;t.pinned||(t.p=t.p.add(s.mult(e))),i.pinned||(i.p=i.p.sub(s.mult(n)))}}(),function(){"use strict";var i=Tetragon.Controls=function(){this.keys=0},t=(i.keyMap={37:i.LEFT=1,38:i.TOP=2,39:i.RIGHT=4,40:i.BOTTOM=8,65:i.LEFT,87:i.TOP,68:i.RIGHT,83:i.BOTTOM},i.prototype);t.pressKeyWithCode=function(t){i.keyMap[t]&&(this.keys|=i.keyMap[t])},t.releaseKeyWithCode=function(t){i.keyMap[t]&&(this.keys&=~i.keyMap[t])},t.isKeyPressed=function(t){return this.keys&t},t.reset=function(){this.keys=0}}(),function(){"use strict";(Tetragon.EntityComponent=function(t,i){this.id=t,this.name=i.name,this.options=i,this.construct=i.construct,this.destruct=i.destruct,this.data=[]}).prototype.iterate=function(t){var i,e=Array.prototype.slice.call(arguments,1);for(i in"string"==typeof t&&(t=this.options[t]),this.data)this.data.hasOwnProperty(i)&&t.apply(this.data[i],e)}}(),function(e){"use strict";var t=(e.EntitySystem=function(){this.entities=[],this.freeEntites=[],this.components=[],this.namedComponents={}}).prototype;t.component=function(t){return this.namedComponents[t]},t.createComponent=function(t){t=e.extend({construct:null,destruct:null},t);var i=this.components.length,i=new e.EntityComponent(i,t);return this.components.push(i),this.namedComponents[i.name]=i},t.entity=function(t){return void 0===this.entities[t]?null:new e.Entity(t,this)},t.createEntity=function(){var t=this.freeEntites.pop();return void 0===t&&(t=this.entities.length+1,this.entities.push(0)),new e.Entity(t,this)},t.iterate=function(t,i){var e=Array.prototype.slice.call(arguments,2),t=this.component(t);t&&(e.unshift(i),t.iterate.apply(t,e))}}(Tetragon),function(){"use strict";var t=(Tetragon.Entity=function(t,i){this.id=t,this.system=i}).prototype;t.addComponent=function(t){var i=Array.prototype.slice.call(arguments,1);if("string"==typeof t&&!(t=this.system.component(t)))return null;if(t.data[this.id-1])return null;var e={entity:this};return t.construct&&t.construct.apply(e,i),t.data[this.id-1]=e,this.system.entities[this.id-1]|=1<<t.id,e},t.removeComponent=function(t){return("string"!=typeof t||(t=this.system.component(t)))&&t.data[this.id-1]?(t.destruct&&t.destruct.apply(t.data[this.id-1]),delete t.data[this.id-1],void(this.system.entities[this.id-1]&=~(1<<t.id))):null},t.componentData=function(t){t=this.system.namedComponents[t];return t?t.data[this.id-1]:null},t.delete=function(){var t=0,i=this.system;if(void 0!==i.entities[this.id-1]){for(var e,n=i.entities[this.id-1];n;)255&n||(n>>=8,t+=8),1&n&&((e=i.components[t]).destruct&&e.destruct.apply(e.data[this.id-1]),delete e.data[this.id-1]),n>>=1,t++;delete i.entities[this.id-1],i.freeEntites.push(this.id)}}}(),function(c){"use strict";c.extend=function(t){if("function"==typeof Object.assign)t=Object.assign.apply(Object,arguments);else{var i,e,n,s=Array.prototype.slice.call(arguments,1);for(t=t||{},i=0;i<s.length;i++)for(e in n=s[i]||{})n.hasOwnProperty(e)&&(t[e]=n[e])}return t},c.loadImages=function(t,n){var i,s,n=n||{},o=0,r=0,a={};function h(){r?n.error&&n.error(a):n.done&&n.done(a)}for(n=c.extend({done:null,error:null,load:null,fail:null,allowCrossOrigin:!1},n),0==(s=Object.keys(t)).length&&n.done&&n.done(a),i=0;i<s.length;i++){var e=s[i],u=t[e];!function(t,i){var e=new Image;n.allowCrossOrigin&&e.setAttribute("crossorigin","anonymous"),e.onload=function(){a[i]||(a[i]=e,n.load&&n.load(i,e),++o>=s.length&&h())},e.onerror=function(){r++,a[i]||(a[i]=void 0,n.fail&&n.fail(i,t),++o>=s.length&&h())},e.src=t}(u=u===Object(u)?u.src:u,e)}}}(Tetragon),function(p){"use strict";(Tetragon.ImageUpscaler=function(){this.frontBuffer=p.createElement("canvas"),this.backBuffer=p.createElement("canvas"),this.frontBuffer.width=64,this.frontBuffer.height=64,this.backBuffer.width=64,this.backBuffer.height=64}).prototype.scale=function(t,i){for(var e,n=t.width,s=t.height,o=n*i.x,r=s*i.y,a=(this.frontBuffer.width=Math.max(o,this.frontBuffer.width),this.frontBuffer.height=Math.max(r,this.frontBuffer.height),this.backBuffer.width=this.frontBuffer.width,this.backBuffer.height=this.frontBuffer.height,this.frontBuffer.getContext("2d")),h=this.backBuffer.getContext("2d"),u=0;u<n;u++)a.drawImage(t,u,0,1,s,u*i.x,0,1,s);for(e=0;e<s;e++)h.drawImage(this.frontBuffer,0,e,o,1,0,e*i.y,o,1);var c=p.createElement("canvas"),f=c.getContext("2d");for(c.width=o,c.height=r,u=0;u<i.x;u++)for(e=0;e<i.y;e++)f.drawImage(this.backBuffer,u,e);return c}}((window,document)),function(e){"use strict";var i=e.Matrix=function(t){t?this.set(t):this.set([1,0,0,1,0,0])},t=i.prototype;t.translate=function(t){return this[4]+=t.x*this[0]+t.y*this[2],this[5]+=t.x*this[1]+t.y*this[3],this},t.scale=function(t){return this[0]*=t.x,this[2]*=t.x,this[1]*=t.y,this[3]*=t.y,this},t.rotate=function(t){t=t/180*Math.PI,i=Math.sin(t),t=Math.cos(t);var i=this.mult(new e.Matrix([t,i,-i,t,0,0]));return this.set(i),this},t.mult=function(t){return e.Vector.prototype.isPrototypeOf(t)?new e.Vector(this[0]*t.x+this[2]*t.y+this[4],this[1]*t.x+this[3]*t.y+this[5]):e.Matrix.prototype.isPrototypeOf(t)?new i([this[0]*t[0]+this[2]*t[1],this[1]*t[0]+this[3]*t[1],this[0]*t[2]+this[2]*t[3],this[1]*t[2]+this[3]*t[3],this[0]*t[4]+this[2]*t[5]+this[4],this[1]*t[4]+this[3]*t[5]+this[5]]):void 0},t.invert=function(){var t,i=new e.Matrix;return i[0]=this[3],i[1]=-this[1],i[2]=-this[2],i[3]=this[0],i[4]=this[2]*this[5]-this[3]*this[4],i[5]=-this[0]*this[5]+this[1]*this[4],0==(t=this[0]*i[0]+this[2]*i[1])?this.copy():(i[0]*=t=1/t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i)},t.copy=function(){return new e.Matrix(this)},t.set=function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this},t.setContextTransform=function(t){t.setTransform(this[0],this[1],this[2],this[3],this[4],this[5])}}(Tetragon),function(i){"use strict";var t=(i.ParticleSystem=function(t){t=i.extend({construct:function(){}},t),this.options=t,this.particles=[]}).prototype;t.add=function(){var t={};return this.options.construct.apply(t,arguments),this.particles.push(t),t},t.iterate=function(t){var i,e=Array.prototype.slice.call(arguments,1),n=this.particles;"string"==typeof t&&(t=this.options[t]);var s={id:0,delete:function(){void 0!==n[i]&&(n[i]=n[n.length-1],n.length--,i--)}};for(e.unshift(s),i=0;i<n.length;i++)s.id=i,t.apply(n[i],e)},t.clear=function(){this.particles.length=0}}(Tetragon),function(e){"use strict";var t=(e.PointMass=function(t,i){this.p=t.copy(),this.pp=t.copy(),this.a=new e.Vector,this.mass=i||1,0==this.mass?this.invMass=Number.MAX_VALUE:this.mass==Number.MAX_VALUE?this.invMass=0:this.invMass=1/this.mass,this.damping=.997,this.pinned=!1}).prototype;t.inertia=function(t){var t=.5*t*t,i=this.p.sub(this.pp).mult(this.damping),i=this.p.add(i.add(this.a.mult(t)));this.pp=this.p.copy(),this.p=i,this.a=new e.Vector},t.applyForce=function(t){this.a=this.a.add(t.mult(this.invMass))},t.pin=function(){this.pp=this.p.copy(),this.pinned=!0}}(Tetragon),function(i){"use strict";var e=i.Range=function(t,i){this.location=t||0,this.length=i||0},t=e.prototype;Object.defineProperty(t,"end",{enumerable:!0,get:function(){return this.location+this.length},set:function(t){this.location=t-this.length}}),t.contains=function(t){return i.Range.prototype.isPrototypeOf(val)?t.location>=this.location&&t.end<=this.end:t>=this.location&&t<this.end},t.intersects=function(t){return t.location<this.end&&t.end>this.location},t.extend=function(t){var i=this.end;e.prototype.isPrototypeOf(t)?t.location<this.location?(this.location=t.location,this.length=i-this.location):t.end>i&&(this.length=t.end-this.location):t<this.location?(this.location=t,this.length=i-t):i<t&&(this.length=t-location)},t.copy=function(){return new e(this.location,this.length)}}(Tetragon),function(s){"use strict";var e=s.Rect=function(t,i){e.prototype.isPrototypeOf(t)?(this.pos=t.pos.copy(),this.size=t.size.copy()):(this.pos=t?t.copy():new s.Vector,this.size=i?i.copy():new s.Vector)},t=e.prototype;Object.defineProperty(t,"maxPos",{enumerable:!0,get:function(){return this.pos.add(this.size)},set:function(t){this.pos=t.sub(this.size)}}),Object.defineProperty(t,"center",{enumerable:!0,get:function(){return this.pos.add(this.size.mult(.5))},set:function(t){this.pos=t.sub(this.size.mult(.5))}}),t.contains=function(t){var i=this.pos,e=this.maxPos;if(s.Vector.prototype.isPrototypeOf(t)){if(t.x>=i.x&&t.x<e.x&&t.y>=i.y&&t.y<e.y)return!0}else if(s.Rect.prototype.isPrototypeOf(t)){var n=t.pos,t=t.maxPos;if(n.x>=i.x&&t.x<=e.x&&n.y>=i.y&&t.y<=e.y)return!0}return!1},t.intersects=function(t){var i=this.pos,e=this.maxPos,n=t.pos,t=t.maxPos;return t.x>i.x&&n.x<e.x&&t.y>i.y&&n.y<e.y},t.extend=function(t){var i=this.maxPos;s.Vector.prototype.isPrototypeOf(t)?(t.x<this.pos.x?(this.pos.x=t.x,this.size.x=i.x-t.x):t.x>i.x&&(this.size.x=t.x-this.pos.x),t.y<this.pos.y?(this.pos.y=t.y,this.size.y=i.y-t.y):t.y>i.y&&(this.size.y=i.y-this.pos.y)):s.Rect.prototype.isPrototypeOf(t)&&(t.pos.x<this.pos.x?(this.pos.x=t.pos.x,this.size.x=i.x-t.pos.x):t.maxPos.x>i.x&&(this.size.x=t.maxPos.x-this.pos.x),t.pos.y<this.pos.y?(this.pos.y=t.pos.y,this.size.y=i.y-t.pos.y):t.maxPos.y>i.y&&(this.size.y=t.maxPos.y-this.pos.y))},t.copy=function(){return new e(this.pos,this.size)}}(Tetragon),function(s,n){"use strict";var t=(n.Canvas=function(t){t=n.extend({element:null,tick:function(){},draw:function(){},framerate:1/120,autoClear:!0,origin:new n.Vector(.5,.5),scale:null},t),this.element=t.element,this.ctx=t.element.getContext("2d"),this.tick=t.tick,this.draw=t.draw,this.framerate=t.framerate,this.animationLoop=new n.AnimationLoop(this.framerate),this._viewport=new n.Rect,this._inverseTrans=null,this._flags=0,this.options=t,this.matrixStack=[],t.autoClear&&(this._flags|=2)}).prototype;Object.defineProperty(t,"viewport",{get:function(){var t=this.element,i=+t.width,t=+t.height;return this._viewport.size.x=i,this._viewport.size.y=t,this._viewport}}),Object.defineProperty(t,"transform",{get:function(){return this.matrixStack.length||this._prepareMatrixStack(),this.matrixStack[this.matrixStack.length-1].copy()},set:function(t){var i;this.matrixStack.length||this._prepareMatrixStack(),(i=this.matrixStack[this.matrixStack.length-1]).set(t),i.setContextTransform(this.ctx),this._flags|=1}}),Object.defineProperty(t,"inverseTransform",{get:function(){return(1&this._flags||!this._inverseTrans)&&(this._inverseTrans=this.transform.invert(),this._flags&=-2),this._inverseTrans.copy()}}),t._prepareMatrixStack=function(){var t=new n.Matrix;this.options.origin&&t.translate(this.options.origin.mult(this.viewport.size)),this.options.scale&&t.scale(this.options.scale),this.matrixStack.push(t)},t._updateTransform=function(t){(t=t||this.transform).setContextTransform(this.ctx)},t._tick=function(){var t,i=this,e=(new Date).getTime()/1e3,n={viewport:i.viewport,ctx:i.ctx};this.framerate?this.animationLoop.advanceToTime(e,function(){n.deltaTime=i.framerate,i.tick(i.framerate,n)}):(t=(t=0)==this.animationLoop.lastTime?1/60:Math.min(1/30,e-this.animationLoop.lastTime),n.deltaTime=t,i.tick(t,n),this.animationLoop.lastTime=e),this.animationLoop.framerate?n.frameDelta=e-this.animationLoop.lastTime:n.frameDelta=0,this._draw(n),this.animationFrame=s.requestAnimationFrame(function(){i._tick()})},t.clear=function(){var t=this.viewport.size,i=t.x,t=t.y;this.ctx.save(),this._updateTransform(new n.Matrix),this.ctx.clearRect(0,0,i,t),this._updateTransform(),this.ctx.restore()},t._draw=function(t){2&this._flags&&this.clear(),this.ctx.save(),this._updateTransform(),this.draw.call(this,this.ctx,t),this.ctx.restore()},t.startAnimating=function(){var t=this;this.animationFrame||(this.animationLoop.reset(),this.animationFrame=s.requestAnimationFrame(function(){t._tick()}))},t.stopAnimating=function(){this.animationFrame&&(s.cancelAnimationFrame(this.animationFrame),this.animationFrame=null)},t.redraw=function(){this._draw({viewport:this.viewport,ctx:this.ctx,deltaTime:0,frameDelta:0})},t.offsetFromEvent=function(t){var i=this.element.getBoundingClientRect(),e=new n.Vector(i.left,i.top);return t.changedTouches?(e.x=t.changedTouches[0].pageX-e.x,e.y=t.changedTouches[0].pageY-e.y):(e.x=t.clientX-e.x,e.y=t.clientY-e.y),e=e.mult(new n.Vector(this.element.width/i.width,this.element.height/i.height))},t.worldPositionFromOffset=function(t){return this.inverseTransform.mult(t)},t.offsetFromWorldPosition=function(t){return this.transform.mult(t)},t.pushMatrix=function(){var t=this.matrixStack.length?this.matrixStack[this.matrixStack.length-1].copy():this.transform;this.matrixStack.push(t)},t.popMatrix=function(){1<this.matrixStack.length&&(this.matrixStack.pop(),this.transform=this.matrixStack[this.matrixStack.length-1])}}(window,(document,Tetragon)),function(n){"use strict";var t=n.QuadTree=function(t){a.call(this,t)},a=t.Quad=function(t,i,e){this.parent=i,this.idx=e,this.quads=[],this.quadFlags=0,this.items=[],this.rect=new n.Rect(t)},h=(a.prototype.addItem=function(t,i,e){var n,s,o=this;for(e=e||new h(t,i);o;){if(s=o.rect.center,!o.items.length){(e.quad=o).items.push(e);break}if(!o.rect.contains(i)){(e.quad=o).items.push(e);break}if(i.pos.x+i.size.x<s.x)n=0;else{if(!(i.pos.x>=s.x)){(e.quad=o).items.push(e);break}n=2}if(i.pos.y+i.size.y<s.y)n+=0;else{if(!(i.pos.y>=s.y)){(e.quad=o).items.push(e);break}n+=1}if(!o.quads[n]){var r=o.rect.copy();switch(r.size.x*=.5,r.size.y*=.5,n){case 0:break;case 1:r.pos.y+=r.size.y;break;case 2:r.pos.x+=r.size.x;break;case 3:r.pos.x+=r.size.x,r.pos.y+=r.size.y}o.quads[n]=new a(r,o,n),o.quadFlags|=1<<n}o=o.quads[n]}return e},a.prototype.forEachItemInRect=function(t,i){for(var e=0;e<this.items.length;e++){var n=this.items[e];i.intersects(n.rect)&&t(n.item,n)}for(e=0;e<this.quads.length;e++){var s=this.quads[e];s&&i.intersects(s.rect)&&s.forEachItemInRect(t,i)}},t.prototype=new a,t.Item=function(t,i){this.quad=null,this.item=t,this.rect=i.copy()});h.prototype.remove=function(t){var i,e=this.quad,n=e.items.indexOf(this);for(e.items.splice(n,1);e&&e!=t;e=i)!(i=e.parent)||e.items.length||e.quadFlags||(delete i.quads[e.idx],i.quadFlags&=~(1<<e.idx))},h.prototype.move=function(t){for(var i=this.quad;i.parent&&!i.rect.contains(t);)i=i.parent;this.rect=new n.Rect(t),this.remove(i),i.addItem(null,t,this)}}(Tetragon);
//# sourceMappingURL=tetragon.min.js.map