!function(a){"use strict";a.Tetragon=a.Tetragon||{version:"0.1.10"}}(window),function(a){"use strict";var b=a.Tween=function(b){b=a.extend({startValue:0,endValue:0,duration:1,done:null,easeFunc:null},b),this.time=0,this.state=0,this.startValue=b.startValue,this.endValue=b.endValue,this.duration=b.duration,this.done=b.done,this.options=b};b.STATE_RUNNING=1,b.STATE_ENDED=2,b.easeInQuad=function(a){return a*a},b.easeOutQuad=function(a){return-a*(a-2)},b.easeInOutQuad=function(a){return(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1)},b.easeInCubic=function(a){return a*a*a},b.easeOutCubic=function(a){return(a-=1)*a*a+1},b.easeInOutCubic=function(a){return(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2)},b.easeInQuart=function(a){return a*a*a*a},b.easeOutQuart=function(a){return-((a-=1)*a*a*a-1)},b.easeInOutQuart=function(a){return(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)},b.easeInQuint=function(a){return a*a*a*a*a},b.easeOutQuint=function(a){return(a-=1)*a*a*a*a+1},b.easeInOutQuint=function(a){return(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)},b.easeInSine=function(a){return-1*Math.cos(a*(Math.PI/2))+1},b.easeOutSine=function(a){return Math.sin(a*(Math.PI/2))},b.easeInOutSine=function(a){return-.5*(Math.cos(Math.PI*a)-1)},b.easeInExpo=function(a){return 0==a?0:1*Math.pow(2,10*(a-1))},b.easeOutExpo=function(a){return 1==a?1:1*(-Math.pow(2,-10*a)+1)},b.easeInOutExpo=function(a){return 0==a?0:1==a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},b.easeInCirc=function(a){return-(Math.sqrt(1-a*a)-1)},b.easeOutCirc=function(a){return Math.sqrt(1-(a-=1)*a)},b.easeInOutCirc=function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},b.easeInElastic=function(a){var b=1.70158,c=0,d=1;if(0==a)return 0;if(1==a)return 1;if(c||(c=.3),d<Math.abs(1)){d=1;var b=c/4}else var b=c/(2*Math.PI)*Math.asin(1/d);return-(d*Math.pow(2,10*(a-=1))*Math.sin((1*a-b)*(2*Math.PI)/c))},b.easeOutElastic=function(a){var b=1.70158,c=0,d=1;if(0==a)return 0;if(1==a)return 1;if(c||(c=.3),d<Math.abs(1)){d=1;var b=c/4}else var b=c/(2*Math.PI)*Math.asin(1/d);return d*Math.pow(2,-10*a)*Math.sin((1*a-b)*(2*Math.PI)/c)+1},b.easeInOutElastic=function(a){var b=1.70158,c=0,d=1;if(0==a)return 0;if(2==(a/=.5))return 1;if(c||(c=1*(.3*1.5)),d<Math.abs(1)){d=1;var b=c/4}else var b=c/(2*Math.PI)*Math.asin(1/d);return 1>a?-.5*(d*Math.pow(2,10*(a-=1))*Math.sin((1*a-b)*(2*Math.PI)/c)):d*Math.pow(2,-10*(a-=1))*Math.sin((1*a-b)*(2*Math.PI)/c)*.5+1},b.easeInBack=function(a,b){return void 0==b&&(b=1.70158),a*a*((b+1)*a-b)},b.easeOutBack=function(a,b){return void 0==b&&(b=1.70158),(a-=1)*a*((b+1)*a+b)+1},b.easeInOutBack=function(a,b){return void 0==b&&(b=1.70158),(a/=.5)<1?.5*(a*a*(((b*=1.525)+1)*a-b)):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},b.easeInBounce=function(a){return 1-b.easeOutBounce(1-a,0)},b.easeOutBounce=function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},b.easeInOutBounce=function(a){return.5>a?.5*b.easeInBounce(2*a,0):.5*b.easeOutBounce(2*a-1,0)+.5};var c=b.prototype;Object.defineProperty(c,"value",{enumerable:!0,get:function(){var a=this.time/this.duration;return this.options.easeFunc&&(a=this.options.easeFunc(a)),this.startValue+a*(this.endValue-this.startValue)}}),c.tick=function(a){var b;this.time=Math.min(this.time+a,this.duration),b=this.time/this.duration,this.time>=this.duration&&this.done&&(this.done(),this.done=null)},c.reset=function(){this.time=0}}(Tetragon),function(a){"use strict";var b=a.Vector=function(a,c){b.prototype.isPrototypeOf(a)?(this.x=a.x,this.y=a.y):(this.x=parseFloat(a)||0,this.y=parseFloat(c)||0)},c=b.prototype;Object.defineProperty(c,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),Object.defineProperty(c,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y}}),Object.defineProperty(c,"negated",{get:function(){return new b(-this.x,-this.y)}}),Object.defineProperty(c,"rotation",{get:function(){var a=Math.atan2(this.y,this.x);return a=0>a?a+2*Math.PI:a,a/Math.PI*180}}),Object.defineProperty(c,"integ",{get:function(){return new b(Math.floor(this.x),Math.floor(this.y))}}),c.add=function(a){return new b(this.x+a.x,this.y+a.y)},c.sub=function(a){return new b(this.x-a.x,this.y-a.y)},c.mult=function(a){return a===Object(a)?new b(this.x*a.x,this.y*a.y):new b(this.x*a,this.y*a)},c.div=function(a){return a===Object(a)?new b(this.x/a.x,this.y/a.y):new b(this.x/a,this.y/a)},c.normalize=function(a){void 0===a&&(a=1);var c=this.length;return c&&(c=a/c),new b(this.x*c,this.y*c)},c.dot=function(a){return this.x*a.x+this.y*a.y},c.rotate=function(a){var c=a/180*Math.PI,d=Math.cos(c),e=Math.sin(c);return new b(this.x*d-this.y*e,this.x*e+this.y*d)},c.reflect=function(a,b){var c;return b=void 0===b?1:.5+.5*b,a=a.normalize(),c=this.sub(a.mult(2*a.dot(this)).mult(b)),2!=b&&(c=c.normalize(this.length)),c},c.inc=function(a){this.x+=a.x,this.y+=a.y},c.dec=function(a){this.x-=a.x,this.y-=a.y},c.shl=function(a){return new b(this.x<<a,this.y<<a)},c.shr=function(a){return new b(this.x>>a,this.y>>a)},c.copy=function(a){return new b(this.x,this.y)}}(Tetragon),function(a){"use strict";var b=a.AnimationLoop=function(a){this.framerate=a,this.lastTime=0},c=b.prototype;c.advanceToTime=function(a,b){for(0==this.lastTime&&(this.lastTime=a-1/60),this.lastTime=Math.max(a-.05,this.lastTime),a-=this.framerate;this.lastTime<a;)b(this.framerate),this.lastTime+=this.framerate},c.reset=function(){this.lastTime=0}}(Tetragon),function(a){"use strict";var b=a.Constraint=function(a,b,c,d){void 0===c&&(c=b.p.sub(a.p).length),void 0===d&&(d=1),this.p1=a,this.p2=b,this.restDist=c,this.stiffness=d},c=b.prototype;c.solve=function(){var a=this.p1,b=this.p2,c=a.p.sub(b.p),d=c.length,e=0;0!=d&&(e=(this.restDist-d)/d),c=c.mult(e);var f=1-a.mass/(a.mass+b.mass),g=f*this.stiffness,h=this.stiffness-g;a.pinned||(a.p=a.p.add(c.mult(g))),b.pinned||(b.p=b.p.sub(c.mult(h)))}}(Tetragon),function(a){"use strict";var b=a.Controls=function(){this.keys=0};b.LEFT=1,b.TOP=2,b.RIGHT=4,b.BOTTOM=8,b.keyMap={37:b.LEFT,38:b.TOP,39:b.RIGHT,40:b.BOTTOM,65:b.LEFT,87:b.TOP,68:b.RIGHT,83:b.BOTTOM};var c=b.prototype;c.pressKeyWithCode=function(a){b.keyMap[a]&&(this.keys|=b.keyMap[a])},c.releaseKeyWithCode=function(a){b.keyMap[a]&&(this.keys&=~b.keyMap[a])},c.isKeyPressed=function(a){return this.keys&a},c.reset=function(){this.keys=0}}(Tetragon),function(a){"use strict";var b=a.EntityComponent=function(a,b){this.id=a,this.name=b.name,this.options=b,this.construct=b.construct,this.destruct=b.destruct,this.data=[]},c=b.prototype;c.iterate=function(a){var b,c=Array.prototype.slice.call(arguments,1);"string"==typeof a&&(a=this.options[a]);for(b in this.data)this.data.hasOwnProperty(b)&&a.apply(this.data[b],c)}}(Tetragon),function(a){"use strict";var b=a.EntitySystem=function(){this.entities=[],this.freeEntites=[],this.components=[],this.namedComponents={}},c=b.prototype;c.component=function(a){return this.namedComponents[a]},c.createComponent=function(b){b=a.extend({construct:null,destruct:null},b);var c=this.components.length,d=new a.EntityComponent(c,b);return this.components.push(d),this.namedComponents[d.name]=d,d},c.entity=function(b){return void 0===this.entities[b]?null:new a.Entity(b,this)},c.createEntity=function(){var b=this.freeEntites.pop();return void 0===b&&(b=this.entities.length+1,this.entities.push(0)),new a.Entity(b,this)},c.iterate=function(a,b){var c=Array.prototype.slice.call(arguments,2),d=this.component(a);d&&(c.unshift(b),d.iterate.apply(d,c))}}(Tetragon),function(a){"use strict";var b=a.Entity=function(a,b){this.id=a,this.system=b},c=b.prototype;c.addComponent=function(a){var b=Array.prototype.slice.call(arguments,1);if("string"==typeof a&&(a=this.system.component(a),!a))return null;if(a.data[this.id-1])return null;var c={};return a.construct&&a.construct.apply(c,b),c.entity=this,a.data[this.id-1]=c,this.system.entities[this.id-1]|=1<<a.id,c},c.removeComponent=function(a){return("string"!=typeof a||(a=this.system.component(a)))&&a.data[this.id-1]?(a.destruct&&a.destruct.apply(a.data[this.id-1]),delete a.data[this.id-1],void(this.system.entities[this.id-1]&=~(1<<a.id))):null},c.componentData=function(a){var b=this.system.namedComponents[a];return b?b.data[this.id-1]:null},c["delete"]=function(){var a=0,b=this.system;if(void 0!==b.entities[this.id-1]){for(var c=b.entities[this.id-1];c;){if(255&c||(c>>=8,a+=8),1&c){var d=b.components[a];d.destruct&&d.destruct.apply(d.data[this.id-1]),delete d.data[this.id-1]}c>>=1,a++}delete b.entities[this.id-1],b.freeEntites.push(this.id)}}}(Tetragon),function(a){"use strict";a.extend=function(a,b){var c,d,e,f=Array.prototype.slice.call(arguments,1);for(a=a||{},c=0;c<f.length;c++){var e=f[c]||{};for(d in e)e.hasOwnProperty(d)&&null!==e[d]&&void 0!==e[d]&&(a[d]=e[d])}return a},a.loadImages=function(b,c){function d(){i?c.error&&c.error(j):c.done&&c.done(j)}function e(a,b){var e=new Image;return e.onload=function(){j[b]||(j[b]=e,c.load&&c.load(b,e),++h>=g.length&&d())},e.onerror=function(){i++,j[b]||(j[b]=void 0,c.fail&&c.fail(b,a),++h>=g.length&&d())},e.src=a,e}var f,g,c=c||{},h=0,i=0,j={};for(c=a.extend({done:null,error:null,load:null,fail:null},c),g=Object.keys(b),0==g.length&&c.done&&c.done(j),f=0;f<g.length;f++){var k=g[f],l=b[k];l===Object(l)&&(l=l.src),e(l,k)}}}(Tetragon),function(a,b,c){"use strict";var d=c.ImageUpscaler=function(){this.frontBuffer=b.createElement("canvas"),this.backBuffer=b.createElement("canvas"),this.frontBuffer.width=64,this.frontBuffer.height=64,this.backBuffer.width=64,this.backBuffer.height=64};d.prototype.scale=function(a,c){var d,e,f=a.width,g=a.height,h=f*c.x,i=g*c.y;this.frontBuffer.width=Math.max(h,this.frontBuffer.width),this.frontBuffer.height=Math.max(i,this.frontBuffer.height),this.backBuffer.width=this.frontBuffer.width,this.backBuffer.height=this.frontBuffer.height;var j=this.frontBuffer.getContext("2d"),k=this.backBuffer.getContext("2d");for(d=0;f>d;d++)j.drawImage(a,d,0,1,g,d*c.x,0,1,g);for(e=0;g>e;e++)k.drawImage(this.frontBuffer,0,e,h,1,0,e*c.y,h,1);var l=b.createElement("canvas"),m=l.getContext("2d");for(l.width=h,l.height=i,d=0;d<c.x;d++)for(e=0;e<c.y;e++)m.drawImage(this.backBuffer,d,e);return l}}(window,document,Tetragon),function(a){"use strict";var b=a.Matrix=function(a){a?this.set(a):this.set([1,0,0,1,0,0])},c=b.prototype;c.translate=function(a){return this[4]+=a.x*this[0]+a.y*this[2],this[5]+=a.x*this[1]+a.y*this[3],this},c.scale=function(a){return this[0]*=a.x,this[2]*=a.x,this[1]*=a.y,this[3]*=a.y,this},c.rotate=function(b){var c,d;b=b/180*Math.PI,c=Math.sin(b),d=Math.cos(b);var e=this.mult(new a.Matrix([d,c,-c,d,0,0]));return this.set(e),this},c.mult=function(c){return a.Vector.prototype.isPrototypeOf(c)?new a.Vector(this[0]*c.x+this[2]*c.y+this[4],this[1]*c.x+this[3]*c.y+this[5]):a.Matrix.prototype.isPrototypeOf(c)?new b([this[0]*c[0]+this[2]*c[1],this[1]*c[0]+this[3]*c[1],this[0]*c[2]+this[2]*c[3],this[1]*c[2]+this[3]*c[3],this[0]*c[4]+this[2]*c[5]+this[4],this[1]*c[4]+this[3]*c[5]+this[5]]):void 0},c.invert=function(){var b,c=new a.Matrix;return c[0]=this[3],c[1]=-this[1],c[2]=-this[2],c[3]=this[0],c[4]=this[2]*this[5]-this[3]*this[4],c[5]=-this[0]*this[5]+this[1]*this[4],b=this[0]*c[0]+this[2]*c[1],0==b?this.copy():(b=1/b,c[0]*=b,c[1]*=b,c[2]*=b,c[3]*=b,c[4]*=b,c[5]*=b,c)},c.copy=function(){return new a.Matrix(this)},c.set=function(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[3],this[4]=a[4],this[5]=a[5],this},c.setContextTransform=function(a){a.setTransform(this[0],this[1],this[2],this[3],this[4],this[5])}}(Tetragon),function(a){"use strict";var b=a.PointMass=function(b,c){this.p=b.copy(),this.pp=b.copy(),this.a=new a.Vector,this.mass=c||1,0==this.mass?this.invMass=Number.MAX_VALUE:this.mass==Number.MAX_VALUE?this.invMass=0:this.invMass=1/this.mass,this.damping=.997,this.pinned=!1},c=b.prototype;c.inertia=function(b){var c=.5*b*b,d=this.p.sub(this.pp).mult(this.damping),e=this.p.add(d.add(this.a.mult(c)));this.pp=this.p.copy(),this.p=e,this.a=new a.Vector},c.applyForce=function(a){this.a=this.a.add(a.mult(this.invMass))},c.pin=function(){this.pp=this.p.copy(),this.pinned=!0}}(Tetragon),function(a){"use strict";var b=a.Range=function(a,b){this.location=a||0,this.length=b||0},c=b.prototype;Object.defineProperty(c,"end",{enumerable:!0,get:function(){return this.location+this.length},set:function(a){this.location=a-this.length}}),c.contains=function(b){return a.Range.prototype.isPrototypeOf(val)?b.location>=this.location&&b.end<=this.end:b>=this.location&&b<this.end},c.intersects=function(a){return a.location<this.end&&a.end>this.location},c.extend=function(a){var c=this.end;b.prototype.isPrototypeOf(a)?a.location<this.location?(this.location=a.location,this.length=c-this.location):a.end>c&&(this.length=a.end-this.location):a<this.location?(this.location=a,this.length=c-a):a>c&&(this.length=a-location)},c.copy=function(){return new b(this.location,this.length)}}(Tetragon),function(a){"use strict";var b=a.Rect=function(c,d){b.prototype.isPrototypeOf(c)?(this.pos=c.pos.copy(),this.size=c.size.copy()):(this.pos=c?c.copy():new a.Vector,this.size=d?d.copy():new a.Vector)},c=b.prototype;Object.defineProperty(c,"maxPos",{enumerable:!0,get:function(){return this.pos.add(this.size)},set:function(a){this.pos=a.sub(this.size)}}),Object.defineProperty(c,"center",{enumerable:!0,get:function(){return this.pos.add(this.size.mult(.5))},set:function(a){this.pos=a.sub(this.size.mult(.5))}}),c.contains=function(b){var c=this.pos,d=this.maxPos;if(a.Vector.prototype.isPrototypeOf(b)){if(b.x>=c.x&&b.x<d.x&&b.y>=c.y&&b.y<d.y)return!0}else if(a.Rect.prototype.isPrototypeOf(b)){var e=b.pos,f=b.maxPos;if(e.x>=c.x&&f.x<=d.x&&e.y>=c.y&&f.y<=d.y)return!0}return!1},c.intersects=function(a){var b=this.pos,c=this.maxPos,d=a.pos,e=a.maxPos;return e.x>b.x&&d.x<c.x&&e.y>b.y&&d.y<c.y?!0:!1},c.extend=function(b){var c=this.maxPos;a.Vector.prototype.isPrototypeOf(b)?(b.x<this.pos.x?(this.pos.x=b.x,this.size.x=c.x-b.x):b.x>c.x&&(this.size.x=b.x-this.pos.x),b.y<this.pos.y?(this.pos.y=b.y,this.size.y=c.y-b.y):b.y>c.y&&(this.size.y=c.y-this.pos.y)):a.Rect.prototype.isPrototypeOf(b)&&(b.pos.x<this.pos.x?(this.pos.x=b.pos.x,this.size.x=c.x-b.pos.x):b.maxPos.x>c.x&&(this.size.x=b.maxPos.x-this.pos.x),b.pos.y<this.pos.y?(this.pos.y=b.pos.y,this.size.y=c.y-b.pos.y):b.maxPos.y>c.y&&(this.size.y=b.maxPos.y-this.pos.y))},c.copy=function(){return new b(this.pos,this.size)}}(Tetragon),function(a,b,c){"use strict";var d=1,e=2,f=c.Canvas=function(a){a=c.extend({element:null,tick:function(){},draw:function(){},framerate:1/120,autoClear:!0,origin:new c.Vector(.5,.5),scale:null},a),this.element=a.element,this.ctx=a.element.getContext("2d"),this.tick=a.tick,this.draw=a.draw,this.framerate=a.framerate,this.animationLoop=new c.AnimationLoop(this.framerate),this._viewport=new c.Rect,this._inverseTrans=null,this._flags=0,this.options=a,this.matrixStack=[],a.autoClear&&(this._flags|=e)},g=f.prototype;Object.defineProperty(g,"viewport",{get:function(){var a=this.element,b=+a.width,c=+a.height;return this._viewport.size.x=b,this._viewport.size.y=c,this._viewport}}),Object.defineProperty(g,"transform",{get:function(){return this.matrixStack.length||this._prepareMatrixStack(),this.matrixStack[this.matrixStack.length-1].copy()},set:function(a){var b;this.matrixStack.length||this._prepareMatrixStack(),b=this.matrixStack[this.matrixStack.length-1],b.set(a),b.setContextTransform(this.ctx),this._flags|=d}}),Object.defineProperty(g,"inverseTransform",{get:function(){return(this._flags&d||!this._inverseTrans)&&(this._inverseTrans=this.transform.invert(),this._flags&=~d),this._inverseTrans.copy()}}),g._prepareMatrixStack=function(){var a=new c.Matrix;this.options.origin&&a.translate(this.options.origin.mult(this.viewport.size)),this.options.scale&&a.scale(this.options.scale),this.matrixStack.push(a)},g._updateTransform=function(a){a=a||this.transform,a.setContextTransform(this.ctx)},g._tick=function(){var b=this,c=(new Date).getTime()/1e3,d={viewport:b.viewport,ctx:b.ctx};if(this.framerate)this.animationLoop.advanceToTime(c,function(){d.deltaTime=b.framerate,b.tick(b.framerate,d)});else{var e=0;e=0==this.animationLoop.lastTime?1/60:c-this.animationLoop.lastTime,d.deltaTime=e,b.tick(e,d),this.animationLoop.lastTime=c}this.animationLoop.framerate?d.frameDelta=c-this.animationLoop.lastTime:d.frameDelta=0,this._draw(d),this.animationFrame=a.requestAnimationFrame(function(){b._tick()})},g.clear=function(){var a=this.viewport.size,b=a.x,d=a.y;this.ctx.save(),this._updateTransform(new c.Matrix),this.ctx.clearRect(0,0,b,d),this._updateTransform(),this.ctx.restore()},g._draw=function(a){this._flags&e&&this.clear(),this.ctx.save(),this._updateTransform(),this.draw.call(this,this.ctx,a),this.ctx.restore()},g.startAnimating=function(){var b=this;this.animationFrame||(this.animationLoop.reset(),this.animationFrame=a.requestAnimationFrame(function(){b._tick()}))},g.stopAnimating=function(){this.animationFrame&&(a.cancelAnimationFrame(this.animationFrame),this.animationFrame=null)},g.redraw=function(){var a=this;this._draw({viewport:a.viewport,ctx:a.ctx,deltaTime:0,frameDelta:0})},g.offsetFromEvent=function(a){var b=this.element,d=b.getBoundingClientRect(),e=new c.Vector(d.left,d.top);return a.changedTouches?(e.x=a.changedTouches[0].pageX-e.x,e.y=a.changedTouches[0].pageY-e.y):(e.x=a.clientX-e.x,e.y=a.clientY-e.y),e=e.mult(new c.Vector(this.element.width/d.width,this.element.height/d.height))},g.worldPositionFromOffset=function(a){return this.inverseTransform.mult(a)},g.offsetFromWorldPosition=function(a){return this.transform.mult(a)},g.pushMatrix=function(){var a;a=this.matrixStack.length?this.matrixStack[this.matrixStack.length-1].copy():this.transform,this.matrixStack.push(a)},g.popMatrix=function(){this.matrixStack.length>1&&(this.matrixStack.pop(),this.transform=this.matrixStack[this.matrixStack.length-1])}}(window,document,Tetragon),function(a){"use strict";var b=a.QuadTree=function(a){c.call(this,a)},c=b.Quad=function(b,c,d){this.parent=c,this.idx=d,this.quads=[],this.quadFlags=0,this.items=[],this.rect=new a.Rect(b)};c.prototype.addItem=function(a,b,e){var f,g,h=this;for(e||(e=new d(a,b));h;){if(g=h.rect.center,!h.items.length){e.quad=h,h.items.push(e);break}if(!h.rect.contains(b)){e.quad=h,h.items.push(e);break}if(b.pos.x+b.size.x<g.x)f=0;else{if(!(b.pos.x>=g.x)){e.quad=h,h.items.push(e);break}f=2}if(b.pos.y+b.size.y<g.y)f+=0;else{if(!(b.pos.y>=g.y)){e.quad=h,h.items.push(e);break}f+=1}if(!h.quads[f]){var i=h.rect.copy();switch(i.size.x*=.5,i.size.y*=.5,f){case 0:break;case 1:i.pos.y+=i.size.y;break;case 2:i.pos.x+=i.size.x;break;case 3:i.pos.x+=i.size.x,i.pos.y+=i.size.y}h.quads[f]=new c(i,h,f),h.quadFlags|=1<<f}h=h.quads[f]}return e},c.prototype.forEachItemInRect=function(a,b){var c,d=this;for(c=0;c<d.items.length;c++){var e=d.items[c];b.intersects(e.rect)&&a(e.item,e)}for(c=0;c<d.quads.length;c++){var f=d.quads[c];f&&b.intersects(f.rect)&&f.forEachItemInRect(a,b)}},b.prototype=new c;var d=b.Item=function(a,b){this.quad=null,this.item=a,this.rect=b.copy()};d.prototype.remove=function(a){var b,c,d=this.quad;for(b=d.items.indexOf(this),d.items.splice(b,1);d&&d!=a;d=c)c=d.parent,!c||d.items.length||d.quadFlags||(delete c.quads[d.idx],c.quadFlags&=~(1<<d.idx))},d.prototype.move=function(b){for(var c=this.quad;c.parent&&!c.rect.contains(b);)c=c.parent;this.rect=new a.Rect(b),this.remove(c),c.addItem(null,b,this)}}(Tetragon);
//# sourceMappingURL=tetragon.min.js.map