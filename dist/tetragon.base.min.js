!function(t){"use strict";t.Tetragon=t.Tetragon||{version:"0.1.13"}}(window),function(u){"use strict";u.extend=function(t){if("function"==typeof Object.assign)t=Object.assign.apply(Object,arguments);else{var i,e,s,n=Array.prototype.slice.call(arguments,1);for(t=t||{},i=0;i<n.length;i++)for(e in s=n[i]||{})s.hasOwnProperty(e)&&(t[e]=s[e])}return t},u.loadImages=function(t,s){var i,n,s=s||{},o=0,r=0,a={};function h(){r?s.error&&s.error(a):s.done&&s.done(a)}for(s=u.extend({done:null,error:null,load:null,fail:null,allowCrossOrigin:!1},s),0==(n=Object.keys(t)).length&&s.done&&s.done(a),i=0;i<n.length;i++){var e=n[i],c=t[e];!function(t,i){var e=new Image;s.allowCrossOrigin&&e.setAttribute("crossorigin","anonymous"),e.onload=function(){a[i]||(a[i]=e,s.load&&s.load(i,e),++o>=n.length&&h())},e.onerror=function(){r++,a[i]||(a[i]=void 0,s.fail&&s.fail(i,t),++o>=n.length&&h())},e.src=t}(c=c===Object(c)?c.src:c,e)}}}(Tetragon),function(){"use strict";var t=(Tetragon.AnimationLoop=function(t){this.framerate=t,this.lastTime=0}).prototype;t.advanceToTime=function(t,i){for(0==this.lastTime&&(this.lastTime=t-1/60),this.lastTime=Math.max(t-.05,this.lastTime),t-=this.framerate;this.lastTime<t;)i(this.framerate),this.lastTime+=this.framerate},t.reset=function(){this.lastTime=0}}(),function(){"use strict";var e=Tetragon.Vector=function(t,i){e.prototype.isPrototypeOf(t)?(this.x=t.x,this.y=t.y):(this.x=parseFloat(t)||0,this.y=parseFloat(i)||0)},t=e.prototype;Object.defineProperty(t,"length",{get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}),Object.defineProperty(t,"lengthSquared",{get:function(){return this.x*this.x+this.y*this.y}}),Object.defineProperty(t,"negated",{get:function(){return new e(-this.x,-this.y)}}),Object.defineProperty(t,"rotation",{get:function(){var t=Math.atan2(this.y,this.x);return(t=t<0?t+2*Math.PI:t)/Math.PI*180}}),Object.defineProperty(t,"integ",{get:function(){return new e(Math.floor(this.x),Math.floor(this.y))}}),t.add=function(t){return new e(this.x+t.x,this.y+t.y)},t.sub=function(t){return new e(this.x-t.x,this.y-t.y)},t.mult=function(t){return t===Object(t)?new e(this.x*t.x,this.y*t.y):new e(this.x*t,this.y*t)},t.div=function(t){return t===Object(t)?new e(this.x/t.x,this.y/t.y):new e(this.x/t,this.y/t)},t.normalize=function(t){void 0===t&&(t=1);var i=(i=this.length)&&t/i;return new e(this.x*i,this.y*i)},t.dot=function(t){return this.x*t.x+this.y*t.y},t.rotate=function(t){var t=t/180*Math.PI,i=Math.cos(t),t=Math.sin(t);return new e(this.x*i-this.y*t,this.x*t+this.y*i)},t.reflect=function(t,i){return i=void 0===i?1:.5+.5*i,t=t.normalize(),t=this.sub(t.mult(2*t.dot(this)).mult(i)),t=2!=i?t.normalize(this.length):t},t.inc=function(t){this.x+=t.x,this.y+=t.y},t.dec=function(t){this.x-=t.x,this.y-=t.y},t.shl=function(t){return new e(this.x<<t,this.y<<t)},t.shr=function(t){return new e(this.x>>t,this.y>>t)},t.copy=function(t){return new e(this.x,this.y)}}(),function(e){"use strict";var i=e.Matrix=function(t){t?this.set(t):this.set([1,0,0,1,0,0])},t=i.prototype;t.translate=function(t){return this[4]+=t.x*this[0]+t.y*this[2],this[5]+=t.x*this[1]+t.y*this[3],this},t.scale=function(t){return this[0]*=t.x,this[2]*=t.x,this[1]*=t.y,this[3]*=t.y,this},t.rotate=function(t){t=t/180*Math.PI,i=Math.sin(t),t=Math.cos(t);var i=this.mult(new e.Matrix([t,i,-i,t,0,0]));return this.set(i),this},t.mult=function(t){return e.Vector.prototype.isPrototypeOf(t)?new e.Vector(this[0]*t.x+this[2]*t.y+this[4],this[1]*t.x+this[3]*t.y+this[5]):e.Matrix.prototype.isPrototypeOf(t)?new i([this[0]*t[0]+this[2]*t[1],this[1]*t[0]+this[3]*t[1],this[0]*t[2]+this[2]*t[3],this[1]*t[2]+this[3]*t[3],this[0]*t[4]+this[2]*t[5]+this[4],this[1]*t[4]+this[3]*t[5]+this[5]]):void 0},t.invert=function(){var t,i=new e.Matrix;return i[0]=this[3],i[1]=-this[1],i[2]=-this[2],i[3]=this[0],i[4]=this[2]*this[5]-this[3]*this[4],i[5]=-this[0]*this[5]+this[1]*this[4],0==(t=this[0]*i[0]+this[2]*i[1])?this.copy():(i[0]*=t=1/t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i)},t.copy=function(){return new e.Matrix(this)},t.set=function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this},t.setContextTransform=function(t){t.setTransform(this[0],this[1],this[2],this[3],this[4],this[5])}}(Tetragon),function(i){"use strict";var e=i.Range=function(t,i){this.location=t||0,this.length=i||0},t=e.prototype;Object.defineProperty(t,"end",{enumerable:!0,get:function(){return this.location+this.length},set:function(t){this.location=t-this.length}}),t.contains=function(t){return i.Range.prototype.isPrototypeOf(val)?t.location>=this.location&&t.end<=this.end:t>=this.location&&t<this.end},t.intersects=function(t){return t.location<this.end&&t.end>this.location},t.extend=function(t){var i=this.end;e.prototype.isPrototypeOf(t)?t.location<this.location?(this.location=t.location,this.length=i-this.location):t.end>i&&(this.length=t.end-this.location):t<this.location?(this.location=t,this.length=i-t):i<t&&(this.length=t-location)},t.copy=function(){return new e(this.location,this.length)}}(Tetragon),function(n){"use strict";var e=n.Rect=function(t,i){e.prototype.isPrototypeOf(t)?(this.pos=t.pos.copy(),this.size=t.size.copy()):(this.pos=t?t.copy():new n.Vector,this.size=i?i.copy():new n.Vector)},t=e.prototype;Object.defineProperty(t,"maxPos",{enumerable:!0,get:function(){return this.pos.add(this.size)},set:function(t){this.pos=t.sub(this.size)}}),Object.defineProperty(t,"center",{enumerable:!0,get:function(){return this.pos.add(this.size.mult(.5))},set:function(t){this.pos=t.sub(this.size.mult(.5))}}),t.contains=function(t){var i=this.pos,e=this.maxPos;if(n.Vector.prototype.isPrototypeOf(t)){if(t.x>=i.x&&t.x<e.x&&t.y>=i.y&&t.y<e.y)return!0}else if(n.Rect.prototype.isPrototypeOf(t)){var s=t.pos,t=t.maxPos;if(s.x>=i.x&&t.x<=e.x&&s.y>=i.y&&t.y<=e.y)return!0}return!1},t.intersects=function(t){var i=this.pos,e=this.maxPos,s=t.pos,t=t.maxPos;return t.x>i.x&&s.x<e.x&&t.y>i.y&&s.y<e.y},t.extend=function(t){var i=this.maxPos;n.Vector.prototype.isPrototypeOf(t)?(t.x<this.pos.x?(this.pos.x=t.x,this.size.x=i.x-t.x):t.x>i.x&&(this.size.x=t.x-this.pos.x),t.y<this.pos.y?(this.pos.y=t.y,this.size.y=i.y-t.y):t.y>i.y&&(this.size.y=i.y-this.pos.y)):n.Rect.prototype.isPrototypeOf(t)&&(t.pos.x<this.pos.x?(this.pos.x=t.pos.x,this.size.x=i.x-t.pos.x):t.maxPos.x>i.x&&(this.size.x=t.maxPos.x-this.pos.x),t.pos.y<this.pos.y?(this.pos.y=t.pos.y,this.size.y=i.y-t.pos.y):t.maxPos.y>i.y&&(this.size.y=t.maxPos.y-this.pos.y))},t.copy=function(){return new e(this.pos,this.size)}}(Tetragon),function(s){"use strict";var t=s.QuadTree=function(t){a.call(this,t)},a=t.Quad=function(t,i,e){this.parent=i,this.idx=e,this.quads=[],this.quadFlags=0,this.items=[],this.rect=new s.Rect(t)},h=(a.prototype.addItem=function(t,i,e){var s,n,o=this;for(e=e||new h(t,i);o;){if(n=o.rect.center,!o.items.length){(e.quad=o).items.push(e);break}if(!o.rect.contains(i)){(e.quad=o).items.push(e);break}if(i.pos.x+i.size.x<n.x)s=0;else{if(!(i.pos.x>=n.x)){(e.quad=o).items.push(e);break}s=2}if(i.pos.y+i.size.y<n.y)s+=0;else{if(!(i.pos.y>=n.y)){(e.quad=o).items.push(e);break}s+=1}if(!o.quads[s]){var r=o.rect.copy();switch(r.size.x*=.5,r.size.y*=.5,s){case 0:break;case 1:r.pos.y+=r.size.y;break;case 2:r.pos.x+=r.size.x;break;case 3:r.pos.x+=r.size.x,r.pos.y+=r.size.y}o.quads[s]=new a(r,o,s),o.quadFlags|=1<<s}o=o.quads[s]}return e},a.prototype.forEachItemInRect=function(t,i){for(var e=0;e<this.items.length;e++){var s=this.items[e];i.intersects(s.rect)&&t(s.item,s)}for(e=0;e<this.quads.length;e++){var n=this.quads[e];n&&i.intersects(n.rect)&&n.forEachItemInRect(t,i)}},t.prototype=new a,t.Item=function(t,i){this.quad=null,this.item=t,this.rect=i.copy()});h.prototype.remove=function(t){var i,e=this.quad,s=e.items.indexOf(this);for(e.items.splice(s,1);e&&e!=t;e=i)!(i=e.parent)||e.items.length||e.quadFlags||(delete i.quads[e.idx],i.quadFlags&=~(1<<e.idx))},h.prototype.move=function(t){for(var i=this.quad;i.parent&&!i.rect.contains(t);)i=i.parent;this.rect=new s.Rect(t),this.remove(i),i.addItem(null,t,this)}}(Tetragon),function(n,s){"use strict";var t=(s.Canvas=function(t){t=s.extend({element:null,tick:function(){},draw:function(){},framerate:1/120,autoClear:!0,origin:new s.Vector(.5,.5),scale:null},t),this.element=t.element,this.ctx=t.element.getContext("2d"),this.tick=t.tick,this.draw=t.draw,this.framerate=t.framerate,this.animationLoop=new s.AnimationLoop(this.framerate),this._viewport=new s.Rect,this._inverseTrans=null,this._flags=0,this.options=t,this.matrixStack=[],t.autoClear&&(this._flags|=2)}).prototype;Object.defineProperty(t,"viewport",{get:function(){var t=this.element,i=+t.width,t=+t.height;return this._viewport.size.x=i,this._viewport.size.y=t,this._viewport}}),Object.defineProperty(t,"transform",{get:function(){return this.matrixStack.length||this._prepareMatrixStack(),this.matrixStack[this.matrixStack.length-1].copy()},set:function(t){var i;this.matrixStack.length||this._prepareMatrixStack(),(i=this.matrixStack[this.matrixStack.length-1]).set(t),i.setContextTransform(this.ctx),this._flags|=1}}),Object.defineProperty(t,"inverseTransform",{get:function(){return(1&this._flags||!this._inverseTrans)&&(this._inverseTrans=this.transform.invert(),this._flags&=-2),this._inverseTrans.copy()}}),t._prepareMatrixStack=function(){var t=new s.Matrix;this.options.origin&&t.translate(this.options.origin.mult(this.viewport.size)),this.options.scale&&t.scale(this.options.scale),this.matrixStack.push(t)},t._updateTransform=function(t){(t=t||this.transform).setContextTransform(this.ctx)},t._tick=function(){var t,i=this,e=(new Date).getTime()/1e3,s={viewport:i.viewport,ctx:i.ctx};this.framerate?this.animationLoop.advanceToTime(e,function(){s.deltaTime=i.framerate,i.tick(i.framerate,s)}):(t=(t=0)==this.animationLoop.lastTime?1/60:Math.min(1/30,e-this.animationLoop.lastTime),s.deltaTime=t,i.tick(t,s),this.animationLoop.lastTime=e),this.animationLoop.framerate?s.frameDelta=e-this.animationLoop.lastTime:s.frameDelta=0,this._draw(s),this.animationFrame=n.requestAnimationFrame(function(){i._tick()})},t.clear=function(){var t=this.viewport.size,i=t.x,t=t.y;this.ctx.save(),this._updateTransform(new s.Matrix),this.ctx.clearRect(0,0,i,t),this._updateTransform(),this.ctx.restore()},t._draw=function(t){2&this._flags&&this.clear(),this.ctx.save(),this._updateTransform(),this.draw.call(this,this.ctx,t),this.ctx.restore()},t.startAnimating=function(){var t=this;this.animationFrame||(this.animationLoop.reset(),this.animationFrame=n.requestAnimationFrame(function(){t._tick()}))},t.stopAnimating=function(){this.animationFrame&&(n.cancelAnimationFrame(this.animationFrame),this.animationFrame=null)},t.redraw=function(){this._draw({viewport:this.viewport,ctx:this.ctx,deltaTime:0,frameDelta:0})},t.offsetFromEvent=function(t){var i=this.element.getBoundingClientRect(),e=new s.Vector(i.left,i.top);return t.changedTouches?(e.x=t.changedTouches[0].pageX-e.x,e.y=t.changedTouches[0].pageY-e.y):(e.x=t.clientX-e.x,e.y=t.clientY-e.y),e=e.mult(new s.Vector(this.element.width/i.width,this.element.height/i.height))},t.worldPositionFromOffset=function(t){return this.inverseTransform.mult(t)},t.offsetFromWorldPosition=function(t){return this.transform.mult(t)},t.pushMatrix=function(){var t=this.matrixStack.length?this.matrixStack[this.matrixStack.length-1].copy():this.transform;this.matrixStack.push(t)},t.popMatrix=function(){1<this.matrixStack.length&&(this.matrixStack.pop(),this.transform=this.matrixStack[this.matrixStack.length-1])}}(window,(document,Tetragon));
//# sourceMappingURL=tetragon.base.min.js.map