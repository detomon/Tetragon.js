{"version":3,"sources":["tetragon.entity.js"],"names":["w","Tetragon","version","window","T","EntityComponent","id","options","this","name","construct","destruct","data","proto","prototype","iterate","func","i","args","Array","slice","call","arguments","hasOwnProperty","apply","EntitySystem","entities","freeEntites","components","namedComponents","component","createComponent","extend","length","push","entity","undefined","Entity","createEntity","pop","unshift","system","addComponent","instance","removeComponent","componentData","n","mask"],"mappings":"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","file":"tetragon.entity.min.js","sourcesContent":["(function (w) {\n'use strict';\n\nw.Tetragon = w.Tetragon || {\n\tversion: '0.1.10',\n};\n\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntityComponent = T.EntityComponent = function (id, options) {\n\tthis.id = id;\n\tthis.name = options.name;\n\tthis.options = options;\n\tthis.construct = options.construct;\n\tthis.destruct = options.destruct;\n\tthis.data = [];\n};\n\nvar proto = EntityComponent.prototype;\n\n/**\n * Iterate entity component data\n *\n * If `func` is a callback, it will be called with the entity component data as\n * first argument followed by all arguments given to this function.\n * If `func` is a string, the corresponding callback of the component is used.\n */\nproto.iterate = function (func) {\n\tvar i;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof func == 'string') {\n\t\tfunc = this.options[func];\n\t}\n\n\tfor (i in this.data) {\n\t\tif (this.data.hasOwnProperty(i)) {\n\t\t\tfunc.apply(this.data[i], args);\n\t\t}\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntitySystem = T.EntitySystem = function () {\n\tthis.entities = [];\n\tthis.freeEntites = [];\n\tthis.components = [];\n\tthis.namedComponents = {};\n};\n\nvar proto = EntitySystem.prototype;\n\nproto.component = function (name) {\n\treturn this.namedComponents[name];\n};\n\nproto.createComponent = function (options) {\n\toptions = T.extend({\n\t\tconstruct: null,\n\t\tdestruct: null,\n\t}, options);\n\n\tvar id = this.components.length;\n\tvar component = new T.EntityComponent(id, options);\n\tthis.components.push(component);\n\tthis.namedComponents[component.name] = component;\n\n\treturn component;\n};\n\nproto.entity = function (id) {\n\tif (this.entities[id] === undefined) {\n\t\treturn null;\n\t}\n\n\treturn new T.Entity(id, this);\n};\n\nproto.createEntity = function () {\n\tvar id = this.freeEntites.pop();\n\n\tif (id === undefined) {\n\t\tid = this.entities.length + 1;\n\t\tthis.entities.push(0);\n\t}\n\n\treturn new T.Entity(id, this);\n};\n\nproto.iterate = function (name, func) {\n\tvar args = Array.prototype.slice.call(arguments, 2);\n\tvar component = this.component(name);\n\n\tif (component) {\n\t\targs.unshift(func);\n\t\tcomponent.iterate.apply(component, args);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-system.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar Entity = T.Entity = function (id, system) {\n\tthis.id = id;\n\tthis.system = system;\n};\n\nvar proto = Entity.prototype;\n\nproto.addComponent = function (component) {\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof component == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tvar instance = {};\n\n\tif (component.construct) {\n\t\tcomponent.construct.apply(instance, args);\n\t}\n\n\tinstance.entity = this;\n\tcomponent.data[this.id - 1] = instance;\n\tthis.system.entities[this.id - 1] |= (1 << component.id);\n\n\treturn instance;\n};\n\nproto.removeComponent = function (component) {\n\tif (typeof component == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (!component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tif (component.destruct) {\n\t\tcomponent.destruct.apply(component.data[this.id - 1]);\n\t}\n\n\tdelete component.data[this.id - 1];\n\tthis.system.entities[this.id - 1] &= ~(1 << component.id);\n};\n\nproto.componentData = function (name) {\n\tvar component = this.system.namedComponents[name];\n\n\tif (!component) {\n\t\treturn null;\n\t}\n\n\treturn component.data[this.id - 1];\n};\n\nproto.delete = function () {\n\tvar n = 0;\n\tvar system = this.system;\n\n\tif (system.entities[this.id - 1] === undefined) {\n\t\treturn;\n\t}\n\n\tvar mask = system.entities[this.id - 1];\n\n\twhile (mask) {\n\t\tif (!(mask & 0xFF)) {\n\t\t\tmask >>= 8;\n\t\t\tn += 8;\n\t\t}\n\n\t\tif (mask & 1) {\n\t\t\tvar component = system.components[n];\n\n\t\t\tif (component.destruct) {\n\t\t\t\tcomponent.destruct.apply(component.data[this.id - 1]);\n\t\t\t}\n\n\t\t\tdelete component.data[this.id - 1];\n\t\t}\n\n\t\tmask >>= 1;\n\t\tn ++;\n\t}\n\n\tdelete system.entities[this.id - 1];\n\tsystem.freeEntites.push(this.id);\n};\n\n}(Tetragon));\n"]}