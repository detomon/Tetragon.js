{"version":3,"sources":["tetragon.base.js"],"names":["w","Tetragon","version","window","T","extend","obj","obj2","i","j","arg","args","Array","prototype","slice","call","arguments","length","hasOwnProperty","undefined","loadImages","images","options","handleDone","errorCount","error","loadedImgs","done","waitForLoad","src","key","image","Image","onload","load","loadCount","keys","onerror","fail","Object","lastTime","vendors","x","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","AnimationLoop","framerate","this","proto","advanceToTime","time","tickFunc","Vector","y","parseFloat","defineProperty","get","sqrt","a","atan2","PI","floor","add","vec","sub","mult","val","div","normalize","mag","len","dot","rotate","r","c","cos","s","sin","reflect","wall","inc","dec","shl","n","shr","copy","Matrix","values","set","translate","scale","m","isPrototypeOf","invert","det","mat","setContextTransform","ctx","setTransform","Range","location","enumerable","end","contains","value","intersects","range","Rect","p","pos","size","maxPos","center","rectPos","rectMaxPos","rect","document","TRANSFORM_UPDATED","AUTO_CLEAR","Canvas","tick","draw","autoClear","origin","autoSetHeight","test","navigator","userAgent","getContext","animationLoop","_viewport","_inverseTrans","_flags","matrixStack","width","height","_prepareMatrixStack","transform","matrix","viewport","push","_updateTransform","_tick","self","info","deltaTime","dt","frameDelta","_draw","animationFrame","clear","save","clearRect","restore","startAnimating","_addResizeListener","stopAnimating","_removeResizeListener","redraw","offsetFromEvent","e","elem","offsetLeft","offsetTop","offsetParent","offset","offsetWidth","changedTouches","pageX","pageY","doc","documentElement","left","pageXOffset","scrollLeft","clientLeft","top","pageYOffset","scrollTop","clientTop","clientX","clientY","worldPositionFromOffset","inverseTransform","offsetFromWorldPosition","pushMatrix","popMatrix","pop","_resizeEventHandler","parentNode","getBoundingClientRect","ratio","style","parseInt","addEventListener","removeEventListener"],"mappings":"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","file":"tetragon.base.min.js","sourcesContent":["(function (w) {\n'use strict';\n\nw.Tetragon = w.Tetragon || {\n\tversion: '0.1.5',\n};\n\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nT.extend = function (obj, obj2) {\n\tvar i, j;\n\tvar arg;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tobj = obj || {};\n\n\tfor (i = 0; i < args.length; i ++) {\n\t\tvar arg = args[i] || {};\n\n\t\tfor (j in arg) {\n\t\t\tif (arg.hasOwnProperty(j)) {\n\t\t\t\tif (arg[j] !== null && arg[j] !== undefined) {\n\t\t\t\t\tobj[j] = arg[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn obj;\n};\n\nT.loadImages = function (images, options) {\n\tvar i;\n\tvar keys;\n\tvar options    = options || {};\n\tvar loadCount  = 0;\n\tvar errorCount = 0;\n\tvar loadedImgs = {};\n\n\tfunction handleDone() {\n\t\tif (errorCount) {\n\t\t\tif (options.error) {\n\t\t\t\toptions.error(loadedImgs);\n\t\t\t}\n\t\t}\n\t\telse if (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfunction waitForLoad(src, key) {\n\t\tvar image = new Image();\n\n\t\timage.onload = function () {\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = image;\n\n\t\t\t\tif (options.load) {\n\t\t\t\t\toptions.load(key, image);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\thandleDone();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.onerror = function () {\n\t\t\terrorCount ++;\n\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = undefined;\n\n\t\t\t\tif (options.fail) {\n\t\t\t\t\toptions.fail(key, src);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\thandleDone();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.src = src;\n\n\t\treturn image;\n\t}\n\n\toptions = T.extend({\n\t\tdone: null,\n\t\terror: null,\n\t\tload: null,\n\t\tfail: null,\n\t}, options);\n\n\tkeys = Object.keys(images);\n\n\tif (keys.length == 0) {\n\t\tif (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfor (i = 0; i < keys.length; i ++) {\n\t\tvar key = keys[i];\n\t\tvar src = images[key];\n\n\t\t// assuming an image element\n\t\tif (src === Object(src)) {\n\t\t\tsrc = src.src;\n\t\t}\n\n\t\twaitForLoad(src, key);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * Polyfill for window.requestAnimationFrame\n *\n * http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n(function (w) {\n\tvar lastTime = 0;\n\tvar vendors = ['webkit', 'moz'];\n\tfor(var x = 0; x < vendors.length && !w.requestAnimationFrame; ++x) {\n\t\tw.requestAnimationFrame = w[vendors[x]+'RequestAnimationFrame'];\n\t\tw.cancelAnimationFrame =\n\t\t  w[vendors[x]+'CancelAnimationFrame'] || w[vendors[x]+'CancelRequestAnimationFrame'];\n\t}\n\n\tif (!w.requestAnimationFrame)\n\t\tw.requestAnimationFrame = function (callback, element) {\n\t\t\tvar currTime = new Date().getTime();\n\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\tvar id = w.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\n\t\t\tlastTime = currTime + timeToCall;\n\t\t\treturn id;\n\t\t};\n\n\tif (!w.cancelAnimationFrame)\n\t\tw.cancelAnimationFrame = function (id) {\n\t\t\tclearTimeout(id);\n\t\t};\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Animation loop\n */\nvar AnimationLoop = T.AnimationLoop = function (framerate) {\n\tthis.framerate = framerate;\n\tthis.lastTime  = 0;\n}\n\nvar proto = AnimationLoop.prototype;\n\n/**\n * Advance animation loop to new time\n *\n * `tickFunc` is called every frame\n */\nproto.advanceToTime = function (time, tickFunc) {\n\t// set `lastTime` to previous frame if first frame\n\tif (this.lastTime == 0) {\n\t\tthis.lastTime = time - 1.0 / 60.0;\n\t}\n\n\t// limit previous time if animation was paused or had a greater lag,\n\t// the loop will not try to catch up with a too big time step\n\tthis.lastTime = Math.max(time - 1.0 / 20.0, this.lastTime)\n\n\t// only advance to previous frame\n\ttime -= this.framerate;\n\n\t// advance to new time\n\twhile (this.lastTime < time) {\n\t\ttickFunc(this.framerate);\n\t\tthis.lastTime += this.framerate;\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Vector = T.Vector = function (x, y) {\n\tthis.x = parseFloat(x) || 0.0;\n\tthis.y = parseFloat(y) || 0.0;\n};\n\nvar proto = Vector.prototype;\n\nObject.defineProperty(proto, 'length', {\n\tget: function () {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n});\n\nObject.defineProperty(proto, 'lengthSquared', {\n\tget: function () {\n\t\treturn this.x * this.x + this.y * this.y;\n\t}\n});\n\nObject.defineProperty(proto, 'negated', {\n\tget: function () {\n\t\treturn new Vector(-this.x, -this.y);\n\t}\n});\n\nObject.defineProperty(proto, 'rotation', {\n\tget: function () {\n\t\tvar a = Math.atan2(this.y, this.x);\n\t\ta = a < 0 ? a + 2.0 * Math.PI : a;\n\t\treturn a / Math.PI * 180.0;\n\t}\n});\n\nObject.defineProperty(proto, 'integ', {\n\tget: function () {\n\t\treturn new Vector(Math.floor(this.x), Math.floor(this.y));\n\t}\n});\n\nproto.add = function (vec) {\n\treturn new Vector(this.x + vec.x, this.y + vec.y);\n};\n\nproto.sub = function (vec) {\n\treturn new Vector(this.x - vec.x, this.y - vec.y);\n};\n\nproto.mult = function (val) {\n\tif (val === Object(val)) {\n\t\treturn new Vector(this.x * val.x, this.y * val.y);\n\t}\n\telse {\n\t\treturn new Vector(this.x * val, this.y * val);\n\t}\n};\n\nproto.div = function (val) {\n\tif (val === Object(val)) {\n\t\treturn new Vector(this.x / val.x, this.y / val.y);\n\t}\n\telse {\n\t\treturn new Vector(this.x / val, this.y / val);\n\t}\n};\n\nproto.normalize = function (mag) {\n\tif (mag === undefined) {\n\t\tmag = 1.0;\n\t}\n\n\tvar len = this.length;\n\n\tif (len) {\n\t\tlen = mag / len;\n\t}\n\n\treturn new Vector(this.x * len, this.y * len);\n};\n\nproto.dot = function (vec) {\n\treturn this.x * vec.x + this.y * vec.y;\n};\n\nproto.rotate = function (a) {\n\tvar r = a / 180.0 * Math.PI;\n\tvar c = Math.cos(r);\n\tvar s = Math.sin(r);\n\n\treturn new Vector(\n\t\tthis.x * c - this.y * s,\n\t\tthis.x * s + this.y * c\n\t);\n};\n\nproto.reflect = function (wall) {\n\twall = wall.normalize();\n\treturn this.sub(wall.mult(2.0 * wall.dot(this)));\n};\n\nproto.inc = function (vec) {\n\tthis.x += vec.x;\n\tthis.y += vec.y;\n};\n\nproto.dec = function (vec) {\n\tthis.x -= vec.x;\n\tthis.y -= vec.y;\n};\n\nproto.shl = function (n) {\n\treturn new Vector(this.x << n, this.y << n);\n};\n\nproto.shr = function (n) {\n\treturn new Vector(this.x >> n, this.y >> n);\n};\n\nproto.copy = function (a) {\n\treturn new Vector(this.x, this.y);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Matrix = T.Matrix = function (values) {\n\tif (values) {\n\t\tthis.set(values);\n\t}\n\telse {\n\t\tthis.set([\n\t\t\t1, 0,\n\t\t\t0, 1,\n\t\t\t0, 0,\n\t\t]);\n\t}\n};\n\nvar proto = Matrix.prototype;\n\nproto.translate = function (vec) {\n\tthis[4] += vec.x * this[0] + vec.y * this[2];\n\tthis[5] += vec.x * this[1] + vec.y * this[3];\n\n\treturn this;\n};\n\nproto.scale = function (vec) {\n\tthis[0] *= vec.x;\n\tthis[2] *= vec.x;\n\tthis[1] *= vec.y;\n\tthis[3] *= vec.y;\n\n\treturn this;\n};\n\nproto.rotate = function (a) {\n\tvar s, c;\n\n\ta = a / 180.0 * Math.PI;\n\ts = Math.sin(a);\n\tc = Math.cos(a);\n\n\tvar m = this.mult(new T.Matrix([\n\t\tc, s,\n\t\t-s, c,\n\t\t0, 0,\n\t]));\n\n\tthis.set(m);\n\n\treturn this;\n};\n\nproto.mult = function (val) {\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\treturn new T.Vector(\n\t\t\tthis[0] * val.x + this[2] * val.y + this[4],\n\t\t\tthis[1] * val.x + this[3] * val.y + this[5]\n\t\t);\n\t}\n\tif (T.Matrix.prototype.isPrototypeOf(val)) {\n\t\treturn new Matrix([\n\t\t\tthis[0] * val[0] + this[2] * val[1],\n\t\t\tthis[1] * val[0] + this[3] * val[1],\n\t\t\tthis[0] * val[2] + this[2] * val[3],\n\t\t\tthis[1] * val[2] + this[3] * val[3],\n\t\t\tthis[0] * val[4] + this[2] * val[5] + this[4],\n\t\t\tthis[1] * val[4] + this[3] * val[5] + this[5]\n\t\t]);\n\t}\n};\n\nproto.invert = function () {\n\tvar det;\n\tvar mat = new T.Matrix();\n\n\tmat[0] =  this[3];\n\tmat[1] = -this[1];\n\tmat[2] = -this[2];\n\tmat[3] =  this[0];\n\tmat[4] =  this[2] * this[5] - this[3] * this[4];\n\tmat[5] = -this[0] * this[5] + this[1] * this[4];\n\n\tdet = this[0] * mat[0] + this[2] * mat[1];\n\n\tif (det == 0.0) {\n\t\treturn this.copy();\n\t}\n\n\tdet = 1.0 / det;\n\n\tmat[0] *= det;\n\tmat[1] *= det;\n\tmat[2] *= det;\n\tmat[3] *= det;\n\tmat[4] *= det;\n\tmat[5] *= det;\n\n\treturn mat;\n};\n\nproto.copy = function () {\n\treturn new T.Matrix(this);\n};\n\nproto.set = function (mat) {\n\tthis[0] = mat[0];\n\tthis[1] = mat[1];\n\tthis[2] = mat[2];\n\tthis[3] = mat[3];\n\tthis[4] = mat[4];\n\tthis[5] = mat[5];\n\n\treturn this;\n};\n\nproto.setContextTransform = function (ctx) {\n\tctx.setTransform(this[0], this[1], this[2], this[3], this[4], this[5]);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Range = T.Range = function (location, length) {\n\tthis.location = location || 0;\n\tthis.length = length || 0;\n};\n\nvar proto = Range.prototype;\n\nObject.defineProperty(proto, 'end', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.location + this.length;\n\t},\n\tset: function (end) {\n\t\tthis.location = end - this.length;\n\t}\n});\n\nproto.contains = function (value) {\n\tif (T.Range.prototype.isPrototypeOf(val)) {\n\t\treturn value.location >= this.location && value.end <= this.end;\n\t}\n\telse {\n\t\treturn value >= this.location && value < this.end;\n\t}\n};\n\nproto.intersects = function (range) {\n\treturn range.location < this.end && range.end > this.location;\n};\n\nproto.extend = function (val) {\n\tvar end = this.end;\n\n\tif (Range.prototype.isPrototypeOf(val)) {\n\t\tif (val.location < this.location) {\n\t\t\tthis.location = val.location;\n\t\t\tthis.length = end - this.location;\n\t\t}\n\t\telse if (val.end > end) {\n\t\t\tthis.length = val.end - this.location;\n\t\t}\n\t}\n\telse {\n\t\tif (val < this.location) {\n\t\t\tthis.location = val;\n\t\t\tthis.length = end - val;\n\t\t}\n\t\telse if (val > end) {\n\t\t\tthis.length = val - location;\n\t\t}\n\t}\n};\n\nproto.copy = function () {\n\treturn new Range(this.location, this.length);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Rect = T.Rect = function (p, s) {\n\tthis.pos  = p ? p.copy() : new T.Vector();\n\tthis.size = s ? s.copy() : new T.Vector();\n};\n\nvar proto = Rect.prototype;\n\nObject.defineProperty(proto, 'maxPos', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size);\n\t},\n\tset: function (maxPos) {\n\t\tthis.pos = maxPos.sub(this.size);\n\t}\n});\n\nObject.defineProperty(proto, 'center', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size.mult(0.5));\n\t},\n\tset: function (center) {\n\t\tthis.pos = center.sub(this.size.mult(0.5));\n\t}\n});\n\nproto.contains = function (val) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\tif (val.x >= pos.x && val.x < maxPos.x) {\n\t\t\tif (val.y >= pos.y && val.y < maxPos.y) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\telse if (T.Rect.prototype.isPrototypeOf(val)) {\n\t\tvar rectPos = val.pos;\n\t\tvar rectMaxPos = val.maxPos;\n\n\t\tif (rectPos.x >= pos.x && rectMaxPos.x <= maxPos.x) {\n\t\t\tif (rectPos.y >= pos.y && rectMaxPos.y <= maxPos.y) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.intersects = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectMaxPos.x > pos.x && rectPos.x < maxPos.x) {\n\t\tif (rectMaxPos.y > pos.y && rectPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.extend = function (val) {\n\tvar maxPos = this.maxPos;\n\n\tif (T.Vector.prototype.isPrototypeOf(val)) {\n\t\tif (val.x < this.pos.x) {\n\t\t\tthis.pos.x = val.x;\n\t\t\tthis.size.x = maxPos.x - val.x;\n\t\t}\n\t\telse if (val.x > maxPos.x) {\n\t\t\tthis.size.x = val.x - this.pos.x;\n\t\t}\n\n\t\tif (val.y < this.pos.y) {\n\t\t\tthis.pos.y = val.y;\n\t\t\tthis.size.y = maxPos.y - val.y;\n\t\t}\n\t\telse if (val.y > maxPos.y) {\n\t\t\tthis.size.y = maxPos.y - this.pos.y;\n\t\t}\n\t}\n\telse if (T.Rect.prototype.isPrototypeOf(val)) {\n\t\tif (val.pos.x < this.pos.x) {\n\t\t\tthis.pos.x = val.pos.x;\n\t\t\tthis.size.x = maxPos.x - val.pos.x;\n\t\t}\n\t\telse if (val.maxPos.x > maxPos.x) {\n\t\t\tthis.size.x = val.maxPos.x - this.pos.x;\n\t\t}\n\n\t\tif (val.pos.y < this.pos.y) {\n\t\t\tthis.pos.y = val.pos.y;\n\t\t\tthis.size.y = maxPos.y - val.pos.y;\n\t\t}\n\t\telse if (val.maxPos.y > maxPos.y) {\n\t\t\tthis.size.y = val.maxPos.y - this.pos.y;\n\t\t}\n\t}\n};\n\nproto.copy = function () {\n\treturn new Rect(this.pos, this.size);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend animation-loop.js\n * @depend vector.js\n * @depend matrix.js\n */\n\n(function (window, document, T) {\n'use strict';\n\nvar TRANSFORM_UPDATED = 1 << 0;\nvar AUTO_CLEAR        = 1 << 1;\n\n/**\n * Encapsulates canvas animation\n */\nvar Canvas = T.Canvas = function (options) {\n\toptions = T.extend({\n\t\telement: null,\n\t\ttick: function () {},\n\t\tdraw: function () {},\n\t\tframerate: 1.0 / 120.0,\n\t\tautoClear: true,\n\t\torigin: new T.Vector(0.5, 0.5),\n\t\tscale: null,\n\t\tautoSetHeight: /MSIE/.test(navigator.userAgent), // IE 10 and below\n\t}, options);\n\n\tthis.element       = options.element;\n\tthis.ctx           = options.element.getContext('2d');\n\tthis.tick          = options.tick;\n\tthis.draw          = options.draw;\n\tthis.framerate     = options.framerate;\n\tthis.animationLoop = new T.AnimationLoop(this.framerate);\n\tthis._viewport     = new T.Rect();\n\tthis._inverseTrans = null;\n\tthis._flags        = 0;\n\tthis.options       = options;\n\tthis.matrixStack   = [];\n\n\tif (options.autoClear) {\n\t\tthis._flags |= AUTO_CLEAR;\n\t}\n};\n\nvar proto = Canvas.prototype;\n\nObject.defineProperty(proto, 'viewport', {\n\tget: function () {\n\t\tvar element = this.element;\n\t\tvar width   = +element.width;\n\t\tvar height  = +element.height;\n\n\t\tthis._viewport.size.x = width;\n\t\tthis._viewport.size.y = height;\n\n\t\treturn this._viewport;\n\t}\n});\n\nObject.defineProperty(proto, 'transform', {\n\tget: function () {\n\t\tvar transform;\n\n\t\tif (!this.matrixStack.length) {\n\t\t\tthis._prepareMatrixStack();\n\t\t}\n\n\t\treturn this.matrixStack[this.matrixStack.length - 1].copy();\n\t},\n\tset: function (transform) {\n\t\tvar matrix;\n\n\t\tif (!this.matrixStack.length) {\n\t\t\tthis._prepareMatrixStack();\n\t\t}\n\n\t\tmatrix = this.matrixStack[this.matrixStack.length - 1];\n\t\tmatrix.set(transform);\n\n\t\tmatrix.setContextTransform(this.ctx);\n\t\tthis._flags |= TRANSFORM_UPDATED;\n\t}\n});\n\nObject.defineProperty(proto, 'inverseTransform', {\n\tget: function () {\n\t\tif (this._flags & TRANSFORM_UPDATED || !this._inverseTrans) {\n\t\t\tthis._inverseTrans = this.transform.invert();\n\t\t\tthis._flags &= ~TRANSFORM_UPDATED;\n\t\t}\n\n\t\treturn this._inverseTrans.copy();\n\t}\n});\n\nproto._prepareMatrixStack = function () {\n\tvar transform = new T.Matrix();\n\n\tif (this.options.origin) {\n\t\ttransform.translate(this.options.origin.mult(this.viewport.size));\n\t}\n\n\tif (this.options.scale) {\n\t\ttransform.scale(this.options.scale);\n\t}\n\n\tthis.matrixStack.push(transform);\n};\n\nproto._updateTransform = function (transform) {\n\ttransform = transform || this.transform;\n\ttransform.setContextTransform(this.ctx);\n};\n\n/**\n * Advance time\n */\nproto._tick = function () {\n\tvar self = this;\n\tvar time = (new Date()).getTime() / 1000;\n\tvar info = {viewport: self.viewport, ctx: self.ctx};\n\n\tif (this.framerate) {\n\t\tthis.animationLoop.advanceToTime(time, function () {\n\t\t\tinfo.deltaTime = self.framerate;\n\t\t\tself.tick(self.framerate, info);\n\t\t});\n\t}\n\t// link framerate to draw rate\n\telse {\n\t\tvar dt = 0;\n\n\t\tif (this.animationLoop.lastTime == 0) {\n\t\t\tdt = 1.0 / 60.0;\n\t\t}\n\t\telse {\n\t\t\tdt = time - this.animationLoop.lastTime;\n\t\t}\n\n\t\tinfo.deltaTime = dt;\n\t\tself.tick(dt, info);\n\n\t\tthis.animationLoop.lastTime = time;\n\t}\n\n\tif (this.animationLoop.framerate) {\n\t\tinfo.frameDelta = time - this.animationLoop.lastTime;\n\t}\n\telse {\n\t\tinfo.frameDelta = 0;\n\t}\n\n\tthis._draw(info);\n\n\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\tself._tick();\n\t});\n};\n\nproto.clear = function () {\n\tvar transform;\n\tvar size   = this.viewport.size;\n\tvar width  = size.x;\n\tvar height = size.y;\n\n\tthis.ctx.save();\n\n\tthis._updateTransform(new T.Matrix());\n\tthis.ctx.clearRect(0, 0, width, height);\n\tthis._updateTransform();\n\n\tthis.ctx.restore();\n};\n\n/**\n * Draw frame\n */\nproto._draw = function (info) {\n\tif (this._flags & AUTO_CLEAR) {\n\t\tthis.clear();\n\t}\n\n\tthis.ctx.save();\n\tthis._updateTransform();\n\n\tthis.draw.call(this, this.ctx, info);\n\n\tthis.ctx.restore();\n};\n\n/**\n * Start animation loop\n */\nproto.startAnimating = function () {\n\tvar self = this;\n\n\tif (!this.animationFrame) {\n\t\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\t\tself._tick();\n\t\t});\n\n\t\tif (this.options.autoSetHeight) {\n\t\t\tthis._addResizeListener();\n\t\t}\n\t}\n};\n\n/**\n * Stop animation loop\n */\nproto.stopAnimating = function () {\n\tif (this.animationFrame) {\n\t\twindow.cancelAnimationFrame(this.animationFrame);\n\t\tthis.animationFrame = null;\n\n\t\tthis._removeResizeListener();\n\t}\n};\n\n/**\n * Redraw frame\n *\n * When resizing\n */\nproto.redraw = function () {\n\tthis._draw();\n};\n\n/**\n * Get canvas offset from mouse event\n */\nproto.offsetFromEvent = function (e) {\n\tvar elem = this.element;\n\tvar x = elem.offsetLeft;\n\tvar y = elem.offsetTop;\n\n\twhile (elem = elem.offsetParent) {\n\t\tx += elem.offsetLeft;\n\t\ty += elem.offsetTop;\n\t}\n\n\tvar offset = new T.Vector(x, y);\n\tvar scale = this.element.offsetWidth / this.element.width;\n\n\tif (!e.changedTouches) {\n\t\tvar doc = document.documentElement;\n\t\tvar left = (window.pageXOffset || doc.scrollLeft) - (doc.clientLeft || 0);\n\t\tvar top = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);\n\n\t\toffset.x = e.clientX - offset.x + left;\n\t\toffset.y = e.clientY - offset.y + top;\n\t}\n\t// is touch event\n\telse {\n\t\toffset.x = e.changedTouches[0].pageX - offset.x;\n\t\toffset.y = e.changedTouches[0].pageY - offset.y;\n\t}\n\n\toffset = offset.mult(1.0 / scale);\n\n\treturn offset;\n};\n\n/**\n * Get world position from relative pixel offset\n */\nproto.worldPositionFromOffset = function (offset) {\n\treturn this.inverseTransform.mult(offset);\n};\n\n/**\n * Get relative pixel offset from world position\n */\nproto.offsetFromWorldPosition = function (offset) {\n\treturn this.transform.mult(offset);\n};\n\n/**\n * Push new matrix to stack\n */\nproto.pushMatrix = function () {\n\tvar matrix;\n\n\tif (this.matrixStack.length) {\n\t\tmatrix = this.matrixStack[this.matrixStack.length - 1].copy();\n\t}\n\telse {\n\t\tmatrix = this.transform;\n\t}\n\n\tthis.matrixStack.push(matrix);\n};\n\n/**\n * Pop matrix from stack\n */\nproto.popMatrix = function () {\n\tif (this.matrixStack.length > 1) {\n\t\tthis.matrixStack.pop();\n\t\tthis.transform = this.matrixStack[this.matrixStack.length - 1];\n\t}\n};\n\n/**\n * Window resize handler\n */\nproto._resizeEventHandler = null;\n\n/**\n * Add event listeners for window resize\n */\nproto._addResizeListener = function () {\n\tvar self = this;\n\n\tif (!this._resizeEventHandler) {\n\t\tthis._resizeEventHandler = function () {\n\t\t\tvar parentNode = self.element.parentNode;\n\t\t\tvar rect = parentNode.getBoundingClientRect();\n\t\t\tvar ratio = self.element.height / self.element.width;\n\n\t\t\tself.element.style.height = parseInt(rect.width * ratio) + 'px';\n\t\t};\n\n\t\twindow.addEventListener('resize', this._resizeEventHandler);\n\t\twindow.addEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler();\n\t}\n};\n\n/**\n * Remove event listeners for window resize\n */\nproto._removeResizeListener = function () {\n\tif (this._resizeEventHandler) {\n\t\twindow.removeEventListener('resize', this._resizeEventHandler);\n\t\twindow.removeEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler = null;\n\t}\n};\n\n}(window, document, Tetragon));\n"]}