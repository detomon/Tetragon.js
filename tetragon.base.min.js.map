{"version":3,"sources":["tetragon.base.js"],"names":["w","Tetragon","version","window","T","extend","obj","obj2","i","j","arg","args","Array","prototype","slice","call","arguments","length","hasOwnProperty","undefined","reduce","items","initValue","value","loadImages","images","options","waitForLoad","src","key","image","Image","onload","loadedImgs","load","loadCount","keys","done","Object","lastTime","vendors","x","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","AnimationLoop","framerate","this","proto","advanceToTime","time","tickFunc","Vector","y","parseFloat","add","vec","sub","inc","dec","shl","n","shr","integ","mult","fac","div","sqrt","lengthSquared","normalize","len","multVec","divVec","dot","reflect","wall","negate","copy","rotate","a","r","PI","c","cos","s","sin","Matrix","values","set","translate","scale","m","multiply","mat","invert","det","setContextTransform","ctx","setTransform","Range","start","defineProperty","enumerable","get","end","containsPoint","point","containsRange","range","intersectsWithRange","Rect","p","pos","size","maxPos","center","containsRect","rect","rectPos","rectMaxPos","intersectsWithRect","TRANSFORM_UPDATED","AUTO_CLEAR","Canvas","tick","draw","autoClear","origin","autoSetHeight","test","navigator","userAgent","getContext","animationLoop","_viewport","_transform","_inverseTrans","_flags","width","height","transform","viewport","_updateTransform","_tick","self","info","deltaTime","dt","frameDelta","_draw","animationFrame","clear","save","clearRect","restore","startAnimating","_addResizeListener","stopAnimating","_removeResizeListener","redraw","offsetFromEvent","e","elem","offsetLeft","offsetTop","offsetParent","offset","offsetWidth","changedTouches","pageX","pageY","docElem","document","documentElement","clientX","scrollLeft","clientY","scrollTop","worldPositionFromOffset","inverseTransform","offsetFromWorldPosition","_resizeEventHandler","parentNode","getBoundingClientRect","ratio","style","parseInt","addEventListener","removeEventListener"],"mappings":"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","file":"tetragon.base.min.js","sourcesContent":["(function (w) {\n'use strict';\n\nw.Tetragon = w.Tetragon || {\n\tversion: '0.1.0',\n};\n\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nT.extend = function (obj, obj2) {\n\tvar i, j;\n\tvar arg;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tfor (i = 0; i < args.length; i ++) {\n\t\tvar arg = args[i];\n\n\t\tfor (j in arg) {\n\t\t\tif (arg.hasOwnProperty(j)) {\n\t\t\t\tif (arg[j] !== null && arg[j] !== undefined) {\n\t\t\t\t\tobj[j] = arg[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn obj;\n};\n\nT.reduce = function (items, initValue, reduce) {\n\tvar i;\n\tvar value = initValue;\n\n\tfor (i = 0; i < items.length; i ++) {\n\t\tvalue = reduce(value, items[i]);\n\t}\n\n\treturn value;\n};\n\nT.loadImages = function (images, options) {\n\tvar i;\n\tvar keys;\n\tvar options    = options || {};\n\tvar loadCount  = 0;\n\tvar loadedImgs = {};\n\n\tfunction waitForLoad(src, key) {\n\t\tvar image = new Image();\n\n\t\timage.onload = function () {\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = image;\n\n\t\t\t\tif (options.load) {\n\t\t\t\t\toptions.load(image);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\tif (options.done) {\n\t\t\t\t\t\toptions.done(loadedImgs);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.src = src;\n\n\t\treturn image;\n\t}\n\n\toptions = T.extend({\n\t\tdone: null,\n\t\tload: null\n\t}, options);\n\n\tkeys = Object.keys(images);\n\n\tif (keys.length == 0) {\n\t\tif (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfor (i = 0; i < keys.length; i ++) {\n\t\tvar key = keys[i];\n\t\tvar src = images[key];\n\n\t\t// assuming an image element\n\t\tif (src === Object(src)) {\n\t\t\tsrc = src.src;\n\t\t}\n\n\t\twaitForLoad(src, key);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * Polyfill for window.requestAnimationFrame\n *\n * http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n(function (w) {\n\tvar lastTime = 0;\n\tvar vendors = ['webkit', 'moz'];\n\tfor(var x = 0; x < vendors.length && !w.requestAnimationFrame; ++x) {\n\t\tw.requestAnimationFrame = w[vendors[x]+'RequestAnimationFrame'];\n\t\tw.cancelAnimationFrame =\n\t\t  w[vendors[x]+'CancelAnimationFrame'] || w[vendors[x]+'CancelRequestAnimationFrame'];\n\t}\n\n\tif (!w.requestAnimationFrame)\n\t\tw.requestAnimationFrame = function (callback, element) {\n\t\t\tvar currTime = new Date().getTime();\n\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\tvar id = w.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\n\t\t\tlastTime = currTime + timeToCall;\n\t\t\treturn id;\n\t\t};\n\n\tif (!w.cancelAnimationFrame)\n\t\tw.cancelAnimationFrame = function (id) {\n\t\t\tclearTimeout(id);\n\t\t};\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Animation loop\n */\nvar AnimationLoop = T.AnimationLoop = function (framerate) {\n\tthis.framerate = framerate;\n\tthis.lastTime  = 0;\n}\n\nvar proto = AnimationLoop.prototype;\n\n/**\n * Advance animation loop to new time\n *\n * `tickFunc` is called every frame\n */\nproto.advanceToTime = function (time, tickFunc) {\n\t// set `lastTime` to previous frame if first frame\n\tif (this.lastTime == 0) {\n\t\tthis.lastTime = time - 1.0 / 60.0;\n\t}\n\n\t// limit previous time if animation was paused or had a greater lag,\n\t// the loop will not try to catch up with a too big time step\n\tthis.lastTime = Math.max(time - 1.0 / 20.0, this.lastTime)\n\n\t// only advance to previous frame\n\ttime -= this.framerate;\n\n\t// advance to new time\n\twhile (this.lastTime < time) {\n\t\ttickFunc(this.framerate);\n\t\tthis.lastTime += this.framerate;\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Vector = T.Vector = function (x, y) {\n\tthis.x = parseFloat(x) || 0.0;\n\tthis.y = parseFloat(y) || 0.0;\n};\n\nvar proto = Vector.prototype;\n\nproto.add = function (vec) {\n\treturn new Vector(this.x + vec.x, this.y + vec.y);\n};\n\nproto.sub = function (vec) {\n\treturn new Vector(this.x - vec.x, this.y - vec.y);\n};\n\nproto.inc = function (vec) {\n\tthis.x += vec.x;\n\tthis.y += vec.y;\n};\n\nproto.dec = function (vec) {\n\tthis.x -= vec.x;\n\tthis.y -= vec.y;\n};\n\nproto.shl = function (n) {\n\treturn new Vector(\n\t\tthis.x << n,\n\t\tthis.y << n\n\t);\n};\n\nproto.shr = function (n) {\n\treturn new Vector(\n\t\tthis.x >> n,\n\t\tthis.y >> n\n\t);\n};\n\nproto.integ = function (n) {\n\treturn new Vector(\n\t\tthis.x | 0,\n\t\tthis.y | 0\n\t);\n};\n\nproto.mult = function (fac) {\n\treturn new Vector(this.x * fac, this.y * fac);\n};\n\nproto.div = function (fac) {\n\treturn new Vector(this.x / fac, this.y / fac);\n};\n\nproto.length = function () {\n\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\nproto.lengthSquared = function () {\n\treturn this.x * this.x + this.y * this.y;\n};\n\nproto.normalize = function (length) {\n\tif (length === undefined) {\n\t\tlength = 1.0;\n\t}\n\n\tvar x   = this.x;\n\tvar y   = this.y;\n\tvar len = this.length();\n\n\tif (len) {\n\t\tlen = length / len;\n\t}\n\n\tx *= len;\n\ty *= len;\n\n\treturn new Vector(x, y);\n};\n\nproto.multVec = function (vec) {\n\treturn new Vector(this.x * vec.x, this.y * vec.y);\n};\n\nproto.divVec = function (vec) {\n\treturn new Vector(this.x / vec.x, this.y / vec.y);\n};\n\nproto.dot = function (vec) {\n\treturn this.x * vec.x + this.y * vec.y;\n};\n\nproto.reflect = function (wall) {\n\twall = wall.normalize();\n\treturn this.sub(wall.mult(2.0 * wall.dot(this)));\n};\n\nproto.negate = function (wall) {\n\treturn new Vector(-this.x, -this.y);\n};\n\nproto.copy = function () {\n\treturn new Vector(this.x, this.y);\n};\n\nproto.rotate = function (a) {\n\tvar r = a / 180.0 * Math.PI;\n\tvar c = Math.cos(r);\n\tvar s = Math.sin(r);\n\n\tvar x = this.x * c - this.y * s;\n\tvar y = this.x * s + this.y * c;\n\n\treturn new Vector(x, y);\n};\n\nproto.copy = function (a) {\n\treturn new Vector(this.x, this.y);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Matrix = T.Matrix = function (values) {\n\tif (values) {\n\t\tthis.set(values);\n\t}\n\telse {\n\t\tthis.set([\n\t\t\t1, 0,\n\t\t\t0, 1,\n\t\t\t0, 0,\n\t\t]);\n\t}\n};\n\nvar proto = Matrix.prototype;\n\nproto.translate = function (vec) {\n\tthis[4] += vec.x * this[0] + vec.y * this[2];\n\tthis[5] += vec.x * this[1] + vec.y * this[3];\n\n\treturn this;\n};\n\nproto.scale = function (vec) {\n\tthis[0] *= vec.x;\n\tthis[2] *= vec.x;\n\tthis[1] *= vec.y;\n\tthis[3] *= vec.y;\n\n\treturn this;\n};\n\nproto.rotate = function (a) {\n\tvar s, c;\n\n\ta = a / 180.0 * Math.PI;\n\ts = Math.sin(a);\n\tc = Math.cos(a);\n\n\tvar m = this.multiply(new T.Matrix([\n\t\tc, s,\n\t\t-s, c,\n\t\t0, 0,\n\t]));\n\n\tthis.set(m);\n\n\treturn this;\n};\n\nproto.multVec = function (vec) {\n\treturn new T.Vector(\n\t\tthis[0] * vec.x + this[2] * vec.y + this[4],\n\t\tthis[1] * vec.x + this[3] * vec.y + this[5]\n\t);\n};\n\nproto.multiply = function (mat) {\n\treturn new Matrix([\n\t\tthis[0] * mat[0] + this[2] * mat[1],\n\t\tthis[1] * mat[0] + this[3] * mat[1],\n\t\tthis[0] * mat[2] + this[2] * mat[3],\n\t\tthis[1] * mat[2] + this[3] * mat[3],\n\t\tthis[0] * mat[4] + this[2] * mat[5] + this[4],\n\t\tthis[1] * mat[4] + this[3] * mat[5] + this[5]\n\t]);\n};\n\nproto.invert = function () {\n\tvar det;\n\tvar mat = new T.Matrix();\n\n\tmat[0] =  this[3];\n\tmat[1] = -this[1];\n\tmat[2] = -this[2];\n\tmat[3] =  this[0];\n\tmat[4] =  this[2] * this[5] - this[3] * this[4];\n\tmat[5] = -this[0] * this[5] + this[1] * this[4];\n\n\tdet = this[0] * mat[0] + this[2] * mat[1];\n\n\tif (det == 0.0) {\n\t\treturn this.copy();\n\t}\n\n\tdet = 1.0 / det;\n\n\tmat[0] *= det;\n\tmat[1] *= det;\n\tmat[2] *= det;\n\tmat[3] *= det;\n\tmat[4] *= det;\n\tmat[5] *= det;\n\n\treturn mat;\n};\n\nproto.copy = function () {\n\treturn new T.Matrix(this);\n};\n\nproto.set = function (mat) {\n\tthis[0] = mat[0];\n\tthis[1] = mat[1];\n\tthis[2] = mat[2];\n\tthis[3] = mat[3];\n\tthis[4] = mat[4];\n\tthis[5] = mat[5];\n\n\treturn this;\n};\n\nproto.setContextTransform = function (ctx) {\n\tctx.setTransform(this[0], this[1], this[2], this[3], this[4], this[5]);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Range = T.Range = function (start, length) {\n\tthis.start = start || 0;\n\tthis.length = length || 0;\n\n};\n\nvar proto = Range.prototype;\n\nObject.defineProperty(proto, 'end', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.start + this.length;\n\t},\n\tset: function (end) {\n\t\tthis.length = end - this.start;\n\t}\n});\n\nproto.containsPoint = function (point) {\n\treturn point >= this.start && point < this.end;\n};\n\nproto.containsRange = function (range) {\n\treturn range.start >= this.start && range.end <= this.end;\n};\n\nproto.intersectsWithRange = function (range) {\n\treturn range.start < this.end && range.end > this.start;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Rect = T.Rect = function (p, s) {\n\tthis.pos  = p ? p.copy() : new T.Vector();\n\tthis.size = s ? s.copy() : new T.Vector();\n};\n\nvar proto = Rect.prototype;\n\nObject.defineProperty(proto, 'maxPos', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size);\n\t},\n\tset: function (maxPos) {\n\t\tthis.size = maxPos.sub(this.size);\n\t}\n});\n\nObject.defineProperty(proto, 'center', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size.mult(0.5));\n\t},\n\tset: function (center) {\n\t\tthis.pos = center.sub(this.size.mult(0.5));\n\t}\n});\n\nproto.containsPoint = function (point) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\n\tif (point.x >= pos.x && point.x < maxPos.x) {\n\t\tif (point.y >= pos.y && point.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.containsRect = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectPos.x >= pos.x && rectMaxPos.x < maxPos.x) {\n\t\tif (rectPos.y >= pos.y && rectMaxPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.intersectsWithRect = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectMaxPos.x > pos.x && rectPos.x < maxPos.x) {\n\t\tif (rectMaxPos.y > pos.y && rectPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.copy = function () {\n\treturn new Rect(this.pos.copy(), this.size.copy());\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend animation-loop.js\n * @depend vector.js\n * @depend matrix.js\n */\n\n(function (T) {\n'use strict';\n\nvar TRANSFORM_UPDATED = 1 << 0;\nvar AUTO_CLEAR        = 1 << 1;\n\n/**\n * Encapsulates canvas animation\n */\nvar Canvas = T.Canvas = function (options) {\n\toptions = T.extend({\n\t\telement: null,\n\t\ttick: function () {},\n\t\tdraw: function () {},\n\t\tframerate: 1.0 / 120.0,\n\t\tautoClear: true,\n\t\torigin: new T.Vector(0.5, 0.5),\n\t\tscale: null,\n\t\tautoSetHeight: /MSIE/.test(navigator.userAgent), // IE 10 and below\n\t}, options);\n\n\tthis.element       = options.element;\n\tthis.ctx           = options.element.getContext('2d');\n\tthis.tick          = options.tick;\n\tthis.draw          = options.draw;\n\tthis.framerate     = options.framerate;\n\tthis.animationLoop = new T.AnimationLoop(this.framerate);\n\tthis._viewport     = new T.Rect();\n\tthis._transform    = null;\n\tthis._inverseTrans = null;\n\tthis._flags        = 0;\n\tthis.options       = options;\n\n\tif (options.autoClear) {\n\t\tthis._flags |= AUTO_CLEAR;\n\t}\n};\n\nvar proto = Canvas.prototype;\n\nObject.defineProperty(proto, 'viewport', {\n\tget: function () {\n\t\tvar element = this.element;\n\t\tvar width   = +element.width;\n\t\tvar height  = +element.height;\n\n\t\tthis._viewport.size.x = width;\n\t\tthis._viewport.size.y = height;\n\n\t\treturn this._viewport;\n\t}\n});\n\nObject.defineProperty(proto, 'transform', {\n\tget: function () {\n\t\tvar transform = this._transform;\n\n\t\tif (!transform) {\n\t\t\ttransform = new T.Matrix();\n\n\t\t\tif (this.options.origin) {\n\t\t\t\ttransform.translate(this.options.origin.multVec(this.viewport.size));\n\t\t\t}\n\n\t\t\tif (this.options.scale) {\n\t\t\t\ttransform.scale(this.options.scale);\n\t\t\t}\n\t\t}\n\n\t\treturn transform;\n\t},\n\tset: function (transform) {\n\t\tif (transform) {\n\t\t\ttransform = transform.copy()\n\t\t}\n\n\t\tthis._transform = transform;\n\t\tthis._transform.setContextTransform(this.ctx);\n\t\tthis._flags |= TRANSFORM_UPDATED;\n\t}\n});\n\nObject.defineProperty(proto, 'inverseTransform', {\n\tget: function () {\n\t\tif (this._flags & TRANSFORM_UPDATED || !this._inverseTrans) {\n\t\t\tthis._inverseTrans = this.transform.invert();\n\t\t\tthis._flags &= ~TRANSFORM_UPDATED;\n\t\t}\n\n\t\treturn this._inverseTrans.copy();\n\t}\n});\n\nproto._updateTransform = function (transform) {\n\ttransform = transform || this.transform;\n\ttransform.setContextTransform(this.ctx);\n};\n\n/**\n * Advance time\n */\nproto._tick = function () {\n\tvar self = this;\n\tvar time = (new Date()).getTime() / 1000;\n\tvar info = {viewport: self.viewport};\n\n\tif (this.framerate) {\n\t\tthis.animationLoop.advanceToTime(time, function () {\n\t\t\tinfo.deltaTime = self.framerate;\n\t\t\tself.tick(self.framerate, info);\n\t\t});\n\t}\n\t// link framerate to draw rate\n\telse {\n\t\tvar dt = 0;\n\n\t\tif (this.animationLoop.lastTime == 0) {\n\t\t\tdt = 1.0 / 60.0;\n\t\t}\n\t\telse {\n\t\t\tdt = time - this.animationLoop.lastTime;\n\t\t}\n\n\t\tinfo.deltaTime = dt;\n\t\tself.tick(dt, info);\n\n\t\tthis.animationLoop.lastTime = time;\n\t}\n\n\tif (this.animationLoop.framerate) {\n\t\tinfo.frameDelta = time - this.animationLoop.lastTime;\n\t}\n\telse {\n\t\tinfo.frameDelta = 0;\n\t}\n\n\tthis._draw(info);\n\n\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\tself._tick();\n\t});\n};\n\nproto.clear = function () {\n\tvar transform;\n\tvar size   = this.viewport.size;\n\tvar width  = size.x;\n\tvar height = size.y;\n\n\tthis.ctx.save();\n\n\tthis._updateTransform(new T.Matrix());\n\tthis.ctx.clearRect(0, 0, width, height);\n\tthis._updateTransform();\n\n\tthis.ctx.restore();\n};\n\n/**\n * Draw frame\n */\nproto._draw = function (info) {\n\tif (this._flags & AUTO_CLEAR) {\n\t\tthis.clear();\n\t}\n\n\tthis.ctx.save();\n\tthis._updateTransform();\n\n\tthis.draw.call(this, this.ctx, info);\n\n\tthis.ctx.restore();\n};\n\n/**\n * Start animation loop\n */\nproto.startAnimating = function () {\n\tvar self = this;\n\n\tif (!this.animationFrame) {\n\t\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\t\tself._tick();\n\t\t});\n\n\t\tif (this.options.autoSetHeight) {\n\t\t\tthis._addResizeListener();\n\t\t}\n\t}\n};\n\n/**\n * Stop animation loop\n */\nproto.stopAnimating = function () {\n\tif (this.animationFrame) {\n\t\twindow.cancelAnimationFrame(this.animationFrame);\n\t\tthis.animationFrame = null;\n\n\t\tthis._removeResizeListener();\n\t}\n};\n\n/**\n * Redraw frame\n *\n * When resizing\n */\nproto.redraw = function () {\n\tthis._draw();\n};\n\n/**\n * Get canvas offset from mouse event\n */\nproto.offsetFromEvent = function (e) {\n\tvar elem = this.element;\n\tvar x = elem.offsetLeft;\n\tvar y = elem.offsetTop;\n\n\twhile (elem = elem.offsetParent) {\n\t\tx += elem.offsetLeft;\n\t\ty += elem.offsetTop;\n\t}\n\n\tvar offset = new T.Vector(x, y);\n\tvar scale = this.element.offsetWidth / this.element.width;\n\n\tif (!e.changedTouches) {\n\t\tvar docElem = document.documentElement;\n\n\t\toffset.x = e.clientX - offset.x + docElem.scrollLeft;\n\t\toffset.y = e.clientY - offset.y + docElem.scrollTop;\n\t}\n\t// is touch event\n\telse {\n\t\toffset.x = e.changedTouches[0].pageX - offset.x;\n\t\toffset.y = e.changedTouches[0].pageY - offset.y;\n\t}\n\n\toffset = offset.mult(1.0 / scale);\n\n\treturn offset;\n};\n\n/**\n * Get world position from relative pixel offset\n */\nproto.worldPositionFromOffset = function (offset) {\n\treturn this.inverseTransform.multVec(offset);\n};\n\n/**\n * Get relative pixel offset from world position\n */\nproto.offsetFromWorldPosition = function (offset) {\n\treturn this.transform.multVec(offset);\n};\n/**\n * Window resize handler\n */\nproto._resizeEventHandler = null;\n\n/**\n * Add event listeners for window resize\n */\nproto._addResizeListener = function () {\n\tvar self = this;\n\n\tif (!this._resizeEventHandler) {\n\t\tthis._resizeEventHandler = function () {\n\t\t\tvar parentNode = self.element.parentNode;\n\t\t\tvar rect = parentNode.getBoundingClientRect();\n\t\t\tvar ratio = self.element.height / self.element.width;\n\n\t\t\tself.element.style.height = parseInt(rect.width * ratio) + 'px';\n\t\t};\n\n\t\twindow.addEventListener('resize', this._resizeEventHandler);\n\t\twindow.addEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler();\n\t}\n};\n\n/**\n * Remove event listeners for window resize\n */\nproto._removeResizeListener = function () {\n\tif (this._resizeEventHandler) {\n\t\twindow.removeEventListener('resize', this._resizeEventHandler);\n\t\twindow.removeEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler = null;\n\t}\n};\n\n}(Tetragon));\n"]}