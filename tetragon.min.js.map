{"version":3,"sources":["tetragon.js"],"names":["w","lastTime","vendors","x","length","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","window","Tetragon","version","T","Tween","options","extend","startValue","endValue","duration","done","easeFunc","this","time","curValue","state","STATE_RUNNING","STATE_ENDED","easeInQuad","t","b","c","d","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","cos","PI","easeOutSine","sin","easeInOutSine","easeInExpo","pow","easeOutExpo","easeInOutExpo","easeInCirc","sqrt","easeOutCirc","easeInOutCirc","easeInElastic","s","p","a","abs","asin","easeOutElastic","easeInOutElastic","easeInBack","undefined","easeOutBack","easeInOutBack","easeInBounce","jQuery","easing","easeOutBounce","easeInOutBounce","proto","prototype","Object","defineProperty","enumerable","get","tick","dt","delta","min","reset","Vector","y","parseFloat","add","vec","sub","inc","dec","shl","n","shr","integ","mult","fac","div","lengthSquared","normalize","len","multVec","divVec","dot","reflect","wall","negate","copy","rotate","r","AnimationLoop","framerate","advanceToTime","tickFunc","Controls","keys","LEFT","TOP","RIGHT","BOTTOM","keyMap",37,38,39,40,65,87,68,83,"pressKeyWithCode","keyCode","releaseKeyWithCode","isKeyPressed","key","EntityComponent","name","construct","destruct","data","iterate","func","i","args","Array","slice","call","arguments","hasOwnProperty","apply","EntitySystem","entities","freeEntites","components","namedComponents","component","createComponent","push","entity","Entity","createEntity","pop","unshift","system","addComponent","instance","removeComponent","componentData","mask","obj","obj2","j","arg","reduce","items","initValue","value","loadImages","images","waitForLoad","src","image","Image","onload","loadedImgs","load","loadCount","Matrix","values","set","translate","scale","m","multiply","mat","invert","det","setContextTransform","ctx","setTransform","PointMass","position","mass","pp","invMass","Number","MAX_VALUE","damping","pinned","inertia","dtf","v","applyForce","force","pin","Range","start","end","containsPoint","point","containsRange","range","intersectsWithRange","Rect","pos","size","maxPos","containsRect","rect","rectPos","rectMaxPos","intersectsWithRect","TRANSFORM_UPDATED","AUTO_CLEAR","Canvas","draw","autoClear","origin","autoSetHeight","test","navigator","userAgent","getContext","animationLoop","_viewport","_transform","_inverseTrans","_flags","width","height","transform","viewport","_updateTransform","_tick","self","info","deltaTime","frameDelta","_draw","animationFrame","clear","save","clearRect","restore","startAnimating","_addResizeListener","stopAnimating","_removeResizeListener","redraw","offsetFromEvent","e","elem","offsetLeft","offsetTop","offsetParent","offset","offsetWidth","changedTouches","pageX","pageY","docElem","document","documentElement","clientX","scrollLeft","clientY","scrollTop","worldPositionFromOffset","inverseTransform","offsetFromWorldPosition","_resizeEventHandler","parentNode","getBoundingClientRect","ratio","style","parseInt","addEventListener","removeEventListener","Constraint","p1","p2","restDist","stiffness","solve","l","f1","s1","s2"],"mappings":"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","file":"tetragon.min.js","sourcesContent":["/**\n * Polyfill for window.requestAnimationFrame\n *\n * http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n(function (w) {\n\tvar lastTime = 0;\n\tvar vendors = ['webkit', 'moz'];\n\tfor(var x = 0; x < vendors.length && !w.requestAnimationFrame; ++x) {\n\t\tw.requestAnimationFrame = w[vendors[x]+'RequestAnimationFrame'];\n\t\tw.cancelAnimationFrame =\n\t\t  w[vendors[x]+'CancelAnimationFrame'] || w[vendors[x]+'CancelRequestAnimationFrame'];\n\t}\n\n\tif (!w.requestAnimationFrame)\n\t\tw.requestAnimationFrame = function (callback, element) {\n\t\t\tvar currTime = new Date().getTime();\n\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\tvar id = w.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\n\t\t\tlastTime = currTime + timeToCall;\n\t\t\treturn id;\n\t\t};\n\n\tif (!w.cancelAnimationFrame)\n\t\tw.cancelAnimationFrame = function (id) {\n\t\t\tclearTimeout(id);\n\t\t};\n}(window));\n\n(function (w) {\n'use strict';\n\nw.Tetragon = w.Tetragon || {};\n\nw.Tetragon.version = '0.1.0';\n\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Tween = T.Tween = function (options) {\n\toptions = T.extend({\n\t\tstartValue: 0,\n\t\tendValue: 0,\n\t\tduration: 1,\n\t\tdone: null,\n\t\teaseFunc: null,\n\t}, options);\n\n\tthis.time       = 0;\n\tthis.curValue   = 0;\n\tthis.state      = 0;\n\tthis.startValue = options.startValue;\n\tthis.endValue   = options.endValue;\n\tthis.duration   = options.duration;\n\tthis.done       = options.done;\n\tthis.options    = options;\n};\n\nTween.STATE_RUNNING = 1;\nTween.STATE_ENDED   = 2;\n\nTween.easeInQuad = function (x, t, b, c, d) {\n\treturn c*(t/=d)*t + b;\n};\n\nTween.easeOutQuad = function (x, t, b, c, d) {\n\treturn -c *(t/=d)*(t-2) + b;\n};\n\nTween.easeInOutQuad = function (x, t, b, c, d) {\n\tif ((t/=d/2) < 1) return c/2*t*t + b;\n\treturn -c/2 * ((--t)*(t-2) - 1) + b;\n};\n\nTween.easeInCubic = function (x, t, b, c, d) {\n\treturn c*(t/=d)*t*t + b;\n};\n\nTween.easeOutCubic = function (x, t, b, c, d) {\n\treturn c*((t=t/d-1)*t*t + 1) + b;\n};\n\nTween.easeInOutCubic = function (x, t, b, c, d) {\n\tif ((t/=d/2) < 1) return c/2*t*t*t + b;\n\treturn c/2*((t-=2)*t*t + 2) + b;\n};\n\nTween.easeInQuart = function (x, t, b, c, d) {\n\treturn c*(t/=d)*t*t*t + b;\n};\n\nTween.easeOutQuart = function (x, t, b, c, d) {\n\treturn -c * ((t=t/d-1)*t*t*t - 1) + b;\n};\n\nTween.easeInOutQuart = function (x, t, b, c, d) {\n\tif ((t/=d/2) < 1) return c/2*t*t*t*t + b;\n\treturn -c/2 * ((t-=2)*t*t*t - 2) + b;\n};\n\nTween.easeInQuint = function (x, t, b, c, d) {\n\treturn c*(t/=d)*t*t*t*t + b;\n};\n\nTween.easeOutQuint = function (x, t, b, c, d) {\n\treturn c*((t=t/d-1)*t*t*t*t + 1) + b;\n};\n\nTween.easeInOutQuint = function (x, t, b, c, d) {\n\tif ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;\n\treturn c/2*((t-=2)*t*t*t*t + 2) + b;\n};\n\nTween.easeInSine = function (x, t, b, c, d) {\n\treturn -c * Math.cos(t/d * (Math.PI/2)) + c + b;\n};\n\nTween.easeOutSine = function (x, t, b, c, d) {\n\treturn c * Math.sin(t/d * (Math.PI/2)) + b;\n};\n\nTween.easeInOutSine = function (x, t, b, c, d) {\n\treturn -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;\n};\n\nTween.easeInExpo = function (x, t, b, c, d) {\n\treturn (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;\n};\n\nTween.easeOutExpo = function (x, t, b, c, d) {\n\treturn (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;\n};\n\nTween.easeInOutExpo = function (x, t, b, c, d) {\n\tif (t==0) return b;\n\tif (t==d) return b+c;\n\tif ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;\n\treturn c/2 * (-Math.pow(2, -10 * --t) + 2) + b;\n};\n\nTween.easeInCirc = function (x, t, b, c, d) {\n\treturn -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;\n};\n\nTween.easeOutCirc = function (x, t, b, c, d) {\n\treturn c * Math.sqrt(1 - (t=t/d-1)*t) + b;\n};\n\nTween.easeInOutCirc = function (x, t, b, c, d) {\n\tif ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;\n\treturn c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;\n};\n\nTween.easeInElastic = function (x, t, b, c, d) {\n\tvar s=1.70158;var p=0;var a=c;\n\tif (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;\n\tif (a < Math.abs(c)) { a=c; var s=p/4; }\n\telse var s = p/(2*Math.PI) * Math.asin (c/a);\n\treturn -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;\n};\n\nTween.easeOutElastic = function (x, t, b, c, d) {\n\tvar s=1.70158;var p=0;var a=c;\n\tif (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;\n\tif (a < Math.abs(c)) { a=c; var s=p/4; }\n\telse var s = p/(2*Math.PI) * Math.asin (c/a);\n\treturn a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;\n};\n\nTween.easeInOutElastic = function (x, t, b, c, d) {\n\tvar s=1.70158;var p=0;var a=c;\n\tif (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);\n\tif (a < Math.abs(c)) { a=c; var s=p/4; }\n\telse var s = p/(2*Math.PI) * Math.asin (c/a);\n\tif (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;\n\treturn a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;\n};\n\nTween.easeInBack = function (x, t, b, c, d, s) {\n\tif (s == undefined) s = 1.70158;\n\treturn c*(t/=d)*t*((s+1)*t - s) + b;\n};\n\nTween.easeOutBack = function (x, t, b, c, d, s) {\n\tif (s == undefined) s = 1.70158;\n\treturn c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;\n};\n\nTween.easeInOutBack = function (x, t, b, c, d, s) {\n\tif (s == undefined) s = 1.70158;\n\tif ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;\n\treturn c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;\n};\n\nTween.easeInBounce = function (x, t, b, c, d) {\n\treturn c - jQuery.easing.easeOutBounce (x, d-t, 0, c, d) + b;\n};\n\nTween.easeOutBounce = function (x, t, b, c, d) {\n\tif ((t/=d) < (1/2.75)) {\n\t\treturn c*(7.5625*t*t) + b;\n\t} else if (t < (2/2.75)) {\n\t\treturn c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;\n\t} else if (t < (2.5/2.75)) {\n\t\treturn c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;\n\t} else {\n\t\treturn c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;\n\t}\n};\n\nTween.easeInOutBounce = function (x, t, b, c, d) {\n\tif (t < d/2) return jQuery.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;\n\treturn jQuery.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;\n};\n\nvar proto = Tween.prototype;\n\nObject.defineProperty(proto, 'value', {\n\tenumerable: true,\n\tget: function () {\n\t\tvar b = this.startValue;\n\t\tvar c = this.endValue - this.startValue;\n\t\tvar d = this.time / this.duration;\n\n\t\treturn this.options.easeFunc ? this.options.easeFunc(null, d, b, c, 1) : this.curValue;\n\t},\n});\n\nproto.tick = function (dt) {\n\tvar delta;\n\n\tthis.time = Math.min(this.time + dt, this.duration);\n\tdelta = this.time / this.duration;\n\tthis.curValue = this.startValue + delta * (this.endValue - this.startValue);\n\n\tif (this.time >= this.duration) {\n\t\tif (this.done) {\n\t\t\tthis.done();\n\t\t\tthis.done = null;\n\t\t}\n\t}\n};\n\nproto.reset = function () {\n\tthis.time = 0;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Vector = T.Vector = function (x, y) {\n\tthis.x = parseFloat(x) || 0.0;\n\tthis.y = parseFloat(y) || 0.0;\n};\n\nvar proto = Vector.prototype;\n\nproto.add = function (vec) {\n\treturn new Vector(this.x + vec.x, this.y + vec.y);\n};\n\nproto.sub = function (vec) {\n\treturn new Vector(this.x - vec.x, this.y - vec.y);\n};\n\nproto.inc = function (vec) {\n\tthis.x += vec.x;\n\tthis.y += vec.y;\n};\n\nproto.dec = function (vec) {\n\tthis.x -= vec.x;\n\tthis.y -= vec.y;\n};\n\nproto.shl = function (n) {\n\treturn new Vector(\n\t\tthis.x << n,\n\t\tthis.y << n\n\t);\n};\n\nproto.shr = function (n) {\n\treturn new Vector(\n\t\tthis.x >> n,\n\t\tthis.y >> n\n\t);\n};\n\nproto.integ = function (n) {\n\treturn new Vector(\n\t\tthis.x | 0,\n\t\tthis.y | 0\n\t);\n};\n\nproto.mult = function (fac) {\n\treturn new Vector(this.x * fac, this.y * fac);\n};\n\nproto.div = function (fac) {\n\treturn new Vector(this.x / fac, this.y / fac);\n};\n\nproto.length = function () {\n\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\nproto.lengthSquared = function () {\n\treturn this.x * this.x + this.y * this.y;\n};\n\nproto.normalize = function (length) {\n\tif (length === undefined) {\n\t\tlength = 1.0;\n\t}\n\n\tvar x   = this.x;\n\tvar y   = this.y;\n\tvar len = this.length();\n\n\tif (len) {\n\t\tlen = length / len;\n\t}\n\n\tx *= len;\n\ty *= len;\n\n\treturn new Vector(x, y);\n};\n\nproto.multVec = function (vec) {\n\treturn new Vector(this.x * vec.x, this.y * vec.y);\n};\n\nproto.divVec = function (vec) {\n\treturn new Vector(this.x / vec.x, this.y / vec.y);\n};\n\nproto.dot = function (vec) {\n\treturn this.x * vec.x + this.y * vec.y;\n};\n\nproto.reflect = function (wall) {\n\twall = wall.normalize();\n\treturn this.sub(wall.mult(2.0 * wall.dot(this)));\n};\n\nproto.negate = function (wall) {\n\treturn new Vector(-this.x, -this.y);\n};\n\nproto.copy = function () {\n\treturn new Vector(this.x, this.y);\n};\n\nproto.rotate = function (a) {\n\tvar r = a / 180.0 * Math.PI;\n\tvar c = Math.cos(r);\n\tvar s = Math.sin(r);\n\n\tvar x = this.x * c - this.y * s;\n\tvar y = this.x * s + this.y * c;\n\n\treturn new Vector(x, y);\n};\n\nproto.copy = function (a) {\n\treturn new Vector(this.x, this.y);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Animation loop\n */\nvar AnimationLoop = T.AnimationLoop = function (framerate) {\n\tthis.framerate = framerate;\n\tthis.lastTime  = 0;\n}\n\nvar proto = AnimationLoop.prototype;\n\n/**\n * Advance animation loop to new time\n *\n * `tickFunc` is called every frame\n */\nproto.advanceToTime = function (time, tickFunc) {\n\t// set `lastTime` to previous frame if first frame\n\tif (this.lastTime == 0) {\n\t\tthis.lastTime = time - 1.0 / 60.0;\n\t}\n\n\t// limit previous time if animation was paused or had a greater lag,\n\t// the loop will not try to catch up with a too big time step\n\tthis.lastTime = Math.max(time - 1.0 / 20.0, this.lastTime)\n\n\t// only advance to previous frame\n\ttime -= this.framerate;\n\n\t// advance to new time\n\twhile (this.lastTime < time) {\n\t\ttickFunc(this.framerate);\n\t\tthis.lastTime += this.framerate;\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Controls = T.Controls = function () {\n\tthis.keys = 0;\n};\n\nControls.LEFT   = 1 << 0;\nControls.TOP    = 1 << 1;\nControls.RIGHT  = 1 << 2;\nControls.BOTTOM = 1 << 3;\n\nControls.keyMap = {\n\t37: Controls.LEFT,   // arrow left\n\t38: Controls.TOP,    // arrow up\n\t39: Controls.RIGHT,  // arrow right\n\t40: Controls.BOTTOM, // arrow down\n\n\t65: Controls.LEFT,   // A\n\t87: Controls.TOP,    // W\n\t68: Controls.RIGHT,  // D\n\t83: Controls.BOTTOM  // S\n};\n\nvar proto = Controls.prototype;\n\nproto.pressKeyWithCode = function (keyCode) {\n\tif (Controls.keyMap[keyCode]) {\n\t\tthis.keys |= Controls.keyMap[keyCode];\n\t}\n};\n\nproto.releaseKeyWithCode = function (keyCode) {\n\tif (Controls.keyMap[keyCode]) {\n\t\tthis.keys &= ~Controls.keyMap[keyCode];\n\t}\n};\n\nproto.isKeyPressed = function (key) {\n\treturn this.keys & key;\n};\n\nproto.reset = function () {\n\tthis.keys = 0;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntityComponent = T.EntityComponent = function (id, options) {\n\tthis.id = id;\n\tthis.name = options.name;\n\tthis.options = options;\n\tthis.construct = options.construct;\n\tthis.destruct = options.destruct;\n\tthis.data = [];\n};\n\nvar proto = EntityComponent.prototype;\n\n/**\n * Iterate entity component data\n *\n * If `func` is a callback, it will be called with the entity component data as\n * first argument followed by all arguments given to this function.\n * If `func` is a string, the corresponding callback of the component is used.\n */\nproto.iterate = function (func) {\n\tvar i;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof func == 'string') {\n\t\tfunc = this.options[func];\n\t}\n\n\tfor (i in this.data) {\n\t\tif (this.data.hasOwnProperty(i)) {\n\t\t\tfunc.apply(this.data[i], args);\n\t\t}\n\t}\n\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntitySystem = T.EntitySystem = function () {\n\tthis.entities = [];\n\tthis.freeEntites = [];\n\tthis.components = [];\n\tthis.namedComponents = {};\n};\n\nvar proto = EntitySystem.prototype;\n\nproto.component = function (name) {\n\treturn this.namedComponents[name];\n};\n\nproto.createComponent = function (options) {\n\toptions = T.extend({\n\t\tconstruct: null,\n\t\tdestruct: null,\n\t}, options);\n\n\tvar id = this.components.length;\n\tvar component = new T.EntityComponent(id, options);\n\tthis.components.push(component);\n\tthis.namedComponents[component.name] = component;\n\n\treturn component;\n};\n\nproto.entity = function (id) {\n\tif (this.entities[id] === undefined) {\n\t\treturn null;\n\t}\n\n\treturn new T.Entity(id, this);\n};\n\nproto.createEntity = function () {\n\tvar id = this.freeEntites.pop();\n\n\tif (id === undefined) {\n\t\tid = this.entities.length + 1;\n\t\tthis.entities.push(0);\n\t}\n\n\treturn new T.Entity(id, this);\n};\n\nproto.iterate = function (name, func) {\n\tvar args = Array.prototype.slice.call(arguments, 2);\n\tvar component = this.component(name);\n\n\tif (component) {\n\t\targs.unshift(func);\n\t\tcomponent.iterate.apply(component, args);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-system.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar Entity = T.Entity = function (id, system) {\n\tthis.id = id;\n\tthis.system = system;\n};\n\nvar proto = Entity.prototype;\n\nproto.addComponent = function (component) {\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof(component) == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tvar instance = {};\n\n\tif (component.construct) {\n\t\tcomponent.construct.apply(instance, args);\n\t}\n\n\tinstance.entity = this;\n\tcomponent.data[this.id - 1] = instance;\n\tthis.system.entities[this.id - 1] |= (1 << component.id);\n\n\treturn instance;\n};\n\nproto.removeComponent = function (component) {\n\tif (typeof(component) == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (!component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tif (component.destruct) {\n\t\tcomponent.destruct.apply(component.data[this.id - 1]);\n\t}\n\n\tdelete component.data[this.id - 1];\n\tthis.system.entities[this.id - 1] &= ~(1 << component.id);\n};\n\nproto.componentData = function (name) {\n\tvar component = this.system.namedComponents[name];\n\n\tif (!component) {\n\t\treturn null;\n\t}\n\n\treturn component.data[this.id - 1];\n};\n\nproto.delete = function () {\n\tvar n = 0;\n\tvar system = this.system;\n\n\tif (system.entities[this.id - 1] === undefined) {\n\t\treturn;\n\t}\n\n\tvar mask = system.entities[this.id - 1];\n\n\twhile (mask) {\n\t\tif (!(mask & 0xFF)) {\n\t\t\tmask >>= 8;\n\t\t\tn += 8;\n\t\t}\n\n\t\tif (mask & 1) {\n\t\t\tvar component = system.components[n];\n\n\t\t\tif (component.destruct) {\n\t\t\t\tcomponent.destruct.apply(component.data[this.id - 1]);\n\t\t\t}\n\n\t\t\tdelete component.data[this.id - 1];\n\t\t}\n\n\t\tmask >>= 1;\n\t\tn ++;\n\t}\n\n\tdelete system.entities[this.id - 1];\n\tsystem.freeEntites.push(this.id);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nT.extend = function (obj, obj2) {\n\tvar i, j;\n\tvar arg;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tfor (i = 0; i < args.length; i ++) {\n\t\tvar arg = args[i];\n\n\t\tfor (j in arg) {\n\t\t\tif (arg.hasOwnProperty(j)) {\n\t\t\t\tif (arg[j] !== null && arg[j] !== undefined) {\n\t\t\t\t\tobj[j] = arg[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn obj;\n};\n\nT.reduce = function (items, initValue, reduce) {\n\tvar i;\n\tvar value = initValue;\n\n\tfor (i = 0; i < items.length; i ++) {\n\t\tvalue = reduce(value, items[i]);\n\t}\n\n\treturn value;\n};\n\nT.loadImages = function (images, options) {\n\tvar i;\n\tvar keys;\n\tvar options    = options || {};\n\tvar loadCount  = 0;\n\tvar loadedImgs = {};\n\n\tfunction waitForLoad(src, key) {\n\t\tvar image = new Image();\n\n\t\timage.onload = function () {\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = image;\n\n\t\t\t\tif (options.load) {\n\t\t\t\t\toptions.load(image);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\tif (options.done) {\n\t\t\t\t\t\toptions.done(loadedImgs);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.src = src;\n\n\t\treturn image;\n\t}\n\n\toptions = T.extend({\n\t\tdone: null,\n\t\tload: null\n\t}, options);\n\n\tkeys = Object.keys(images);\n\n\tif (keys.length == 0) {\n\t\tif (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfor (i = 0; i < keys.length; i ++) {\n\t\tvar key = keys[i];\n\t\tvar src = images[key];\n\n\t\t// assuming an image element\n\t\tif (src === Object(src)) {\n\t\t\tsrc = src.src;\n\t\t}\n\n\t\twaitForLoad(src, key);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Matrix = T.Matrix = function (values) {\n\tif (values) {\n\t\tthis.set(values);\n\t}\n\telse {\n\t\tthis.set([\n\t\t\t1, 0,\n\t\t\t0, 1,\n\t\t\t0, 0,\n\t\t]);\n\t}\n};\n\nvar proto = Matrix.prototype;\n\nproto.translate = function (vec) {\n\tthis[4] += vec.x * this[0] + vec.y * this[2];\n\tthis[5] += vec.x * this[1] + vec.y * this[3];\n\n\treturn this;\n};\n\nproto.scale = function (vec) {\n\tthis[0] *= vec.x;\n\tthis[2] *= vec.x;\n\tthis[1] *= vec.y;\n\tthis[3] *= vec.y;\n\n\treturn this;\n};\n\nproto.rotate = function (a) {\n\tvar s, c;\n\n\ta = a / 180.0 * Math.PI;\n\ts = Math.sin(a);\n\tc = Math.cos(a);\n\n\tvar m = this.multiply(new T.Matrix([\n\t\tc, s,\n\t\t-s, c,\n\t\t0, 0,\n\t]));\n\n\tthis.set(m);\n\n\treturn this;\n};\n\nproto.multVec = function (vec) {\n\treturn new T.Vector(\n\t\tthis[0] * vec.x + this[2] * vec.y + this[4],\n\t\tthis[1] * vec.x + this[3] * vec.y + this[5]\n\t);\n};\n\nproto.multiply = function (mat) {\n\treturn new Matrix([\n\t\tthis[0] * mat[0] + this[2] * mat[1],\n\t\tthis[1] * mat[0] + this[3] * mat[1],\n\t\tthis[0] * mat[2] + this[2] * mat[3],\n\t\tthis[1] * mat[2] + this[3] * mat[3],\n\t\tthis[0] * mat[4] + this[2] * mat[5] + this[4],\n\t\tthis[1] * mat[4] + this[3] * mat[5] + this[5]\n\t]);\n};\n\nproto.invert = function () {\n\tvar det;\n\tvar mat = new T.Matrix();\n\n\tmat[0] =  this[3];\n\tmat[1] = -this[1];\n\tmat[2] = -this[2];\n\tmat[3] =  this[0];\n\tmat[4] =  this[2] * this[5] - this[3] * this[4];\n\tmat[5] = -this[0] * this[5] + this[1] * this[4];\n\n\tdet = this[0] * mat[0] + this[2] * mat[1];\n\n\tif (det == 0.0) {\n\t\treturn this.copy();\n\t}\n\n\tdet = 1.0 / det;\n\n\tmat[0] *= det;\n\tmat[1] *= det;\n\tmat[2] *= det;\n\tmat[3] *= det;\n\tmat[4] *= det;\n\tmat[5] *= det;\n\n\treturn mat;\n};\n\nproto.copy = function () {\n\treturn new T.Matrix(this);\n};\n\nproto.set = function (mat) {\n\tthis[0] = mat[0];\n\tthis[1] = mat[1];\n\tthis[2] = mat[2];\n\tthis[3] = mat[3];\n\tthis[4] = mat[4];\n\tthis[5] = mat[5];\n\n\treturn this;\n};\n\nproto.setContextTransform = function (ctx) {\n\tctx.setTransform(this[0], this[1], this[2], this[3], this[4], this[5]);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Defines a point mass\n *\n * The point is initialized with an initial `position` and a `mass`\n * More mass means more inertness\n */\nvar PointMass = T.PointMass = function (position, mass) {\n\t// current position\n\tthis.p = position.copy();\n\n\t// previous position\n\tthis.pp = position.copy();\n\n\t// acceleration for current frame\n\tthis.a = new T.Vector(); // null vector\n\n\t// mass; set to 1.0 if not defined\n\tthis.mass = mass || 1.0;\n\n\t// inverse mass\n\tif (this.mass == 0.0) {\n\t\tthis.invMass = Number.MAX_VALUE;\n\t}\n\telse if (this.mass == Number.MAX_VALUE) {\n\t\tthis.invMass = 0.0;\n\t}\n\telse {\n\t\tthis.invMass = 1.0 / this.mass;\n\t}\n\n\t// set default damping value\n\tthis.damping = 0.997;\n\n\t// `true` if pinned to current position\n\tthis.pinned = false;\n};\n\nvar proto = PointMass.prototype;\n\n/**\n * Move point to next position\n */\nproto.inertia = function(dt) {\n\t// time depending factor used for acceleration\n\t// dtf = 0.5 * dt^2\n\tvar dtf = 0.5 * dt * dt;\n\n\t// get velocity vector and add damping\n\t// v = (p - pp) * damping\n\tvar v = this.p.sub(this.pp).mult(this.damping);\n\n\t// this is more accurate, but also slower\n\t// v = (p - pp) * damping ^ dt\n\t//var v = this.p.sub(this.pp).mult(Math.pow(this.damping, dt));\n\n\t// calculate next position by adding velocity\n\t// and acceleration to current position\n\t// n = p + v + a * dtf\n\tvar n = this.p.add(v.add(this.a.mult(dtf)));\n\n\t// set previous position to current position\n\tthis.pp = this.p.copy();\n\n\t// set current position to next position\n\tthis.p = n;\n\n\t// clear acceleration for current step\n\tthis.a = new T.Vector();\n};\n\n/**\n * Add force vector\n */\nproto.applyForce = function(force) {\n\t// add force multiplied with inverse of mass\n\t// a += force * (1.0 / mass)\n\tthis.a = this.a.add(force.mult(this.invMass));\n};\n\n/**\n * Pin point to its current position\n */\nproto.pin = function() {\n\tthis.pp     = this.p.copy();\n\tthis.pinned = true;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Range = T.Range = function (start, length) {\n\tthis.start = start || 0;\n\tthis.length = length || 0;\n\n};\n\nvar proto = Range.prototype;\n\nObject.defineProperty(proto, 'end', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.start + this.length;\n\t},\n\tset: function (end) {\n\t\tthis.length = end - this.start;\n\t}\n});\n\nproto.containsPoint = function (point) {\n\treturn point >= this.start && point < this.end;\n};\n\nproto.containsRange = function (range) {\n\treturn range.start >= this.start && range.end <= this.end;\n};\n\nproto.intersectsWithRange = function (range) {\n\treturn range.start < this.end && range.end > this.start;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Rect = T.Rect = function (p, s) {\n\tthis.pos  = p ? p.copy() : new T.Vector();\n\tthis.size = s ? s.copy() : new T.Vector();\n};\n\nvar proto = Rect.prototype;\n\nObject.defineProperty(proto, 'maxPos', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size);\n\t},\n\tset: function (maxPos) {\n\t\tthis.size = maxPos.sub(this.size);\n\t}\n});\n\nproto.containsPoint = function (point) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\n\tif (point.x >= pos.x && point.x < maxPos.x) {\n\t\tif (point.y >= pos.y && point.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.containsRect = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectPos.x >= pos.x && rectMaxPos.x < maxPos.x) {\n\t\tif (rectPos.y >= pos.y && rectMaxPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.intersectsWithRect = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectMaxPos.x > pos.x && rectPos.x < maxPos.x) {\n\t\tif (rectMaxPos.y > pos.y && rectPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend animation-loop.js\n * @depend vector.js\n * @depend matrix.js\n */\n\n(function (T) {\n'use strict';\n\nvar TRANSFORM_UPDATED = 1 << 0;\nvar AUTO_CLEAR        = 1 << 1;\n\n/**\n * Encapsulates canvas animation\n */\nvar Canvas = T.Canvas = function (options) {\n\toptions = T.extend({\n\t\telement: null,\n\t\ttick: function () {},\n\t\tdraw: function () {},\n\t\tframerate: 1.0 / 120.0,\n\t\tautoClear: true,\n\t\torigin: new T.Vector(0.5, 0.5),\n\t\tscale: null,\n\t\tautoSetHeight: /MSIE/.test(navigator.userAgent), // IE 10 and below\n\t}, options);\n\n\tthis.element       = options.element;\n\tthis.ctx           = options.element.getContext('2d');\n\tthis.tick          = options.tick;\n\tthis.draw          = options.draw;\n\tthis.framerate     = options.framerate;\n\tthis.animationLoop = new T.AnimationLoop(this.framerate);\n\tthis._viewport     = new T.Rect();\n\tthis._transform    = null;\n\tthis._inverseTrans = null;\n\tthis._flags        = 0;\n\tthis.options       = options;\n\n\tif (options.autoClear) {\n\t\tthis._flags |= AUTO_CLEAR;\n\t}\n};\n\nvar proto = Canvas.prototype;\n\nObject.defineProperty(proto, 'viewport', {\n\tget: function () {\n\t\tvar element = this.element;\n\t\tvar width   = +element.width;\n\t\tvar height  = +element.height;\n\n\t\tthis._viewport.size.x = width;\n\t\tthis._viewport.size.y = height;\n\n\t\treturn this._viewport;\n\t}\n});\n\nObject.defineProperty(proto, 'transform', {\n\tget: function () {\n\t\tvar transform = this._transform;\n\n\t\tif (!transform) {\n\t\t\ttransform = new T.Matrix();\n\n\t\t\tif (this.options.origin) {\n\t\t\t\ttransform.translate(this.options.origin.multVec(this.viewport.size));\n\t\t\t}\n\n\t\t\tif (this.options.scale) {\n\t\t\t\ttransform.scale(this.options.scale);\n\t\t\t}\n\t\t}\n\n\t\treturn transform;\n\t},\n\tset: function (transform) {\n\t\tif (transform) {\n\t\t\ttransform = transform.copy()\n\t\t}\n\n\t\tthis._transform = transform;\n\t\tthis._transform.setContextTransform(this.ctx);\n\t\tthis._flags |= TRANSFORM_UPDATED;\n\t}\n});\n\nObject.defineProperty(proto, 'inverseTransform', {\n\tget: function () {\n\t\tif (this._flags & TRANSFORM_UPDATED || !this._inverseTrans) {\n\t\t\tthis._inverseTrans = this.transform.invert();\n\t\t\tthis._flags &= ~TRANSFORM_UPDATED;\n\t\t}\n\n\t\treturn this._inverseTrans.copy();\n\t}\n});\n\nproto._updateTransform = function (transform) {\n\ttransform = transform || this.transform;\n\ttransform.setContextTransform(this.ctx);\n};\n\n/**\n * Advance time\n */\nproto._tick = function () {\n\tvar self = this;\n\tvar time = (new Date()).getTime() / 1000;\n\tvar info = {viewport: self.viewport};\n\n\tif (this.framerate) {\n\t\tthis.animationLoop.advanceToTime(time, function () {\n\t\t\tinfo.deltaTime = self.framerate;\n\t\t\tself.tick(self.framerate, info);\n\t\t});\n\t}\n\t// link framerate to draw rate\n\telse {\n\t\tvar dt = 0;\n\n\t\tif (this.animationLoop.lastTime == 0) {\n\t\t\tdt = 1.0 / 60.0;\n\t\t}\n\t\telse {\n\t\t\tdt = time - this.animationLoop.lastTime;\n\t\t}\n\n\t\tinfo.deltaTime = dt;\n\t\tself.tick(dt, info);\n\n\t\tthis.animationLoop.lastTime = time;\n\t}\n\n\tif (this.animationLoop.framerate) {\n\t\tinfo.frameDelta = time - this.animationLoop.lastTime;\n\t}\n\telse {\n\t\tinfo.frameDelta = 0;\n\t}\n\n\tthis._draw(info);\n\n\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\tself._tick();\n\t});\n};\n\nproto.clear = function () {\n\tvar transform;\n\tvar size   = this.viewport.size;\n\tvar width  = size.x;\n\tvar height = size.y;\n\n\tthis.ctx.save();\n\n\tthis._updateTransform(new T.Matrix());\n\tthis.ctx.clearRect(0, 0, width, height);\n\tthis._updateTransform();\n\n\tthis.ctx.restore();\n};\n\n/**\n * Draw frame\n */\nproto._draw = function (info) {\n\tif (this._flags & AUTO_CLEAR) {\n\t\tthis.clear();\n\t}\n\n\tthis.ctx.save();\n\tthis._updateTransform();\n\n\tthis.draw.call(this, this.ctx, info);\n\n\tthis.ctx.restore();\n};\n\n/**\n * Start animation loop\n */\nproto.startAnimating = function () {\n\tvar self = this;\n\n\tif (!this.animationFrame) {\n\t\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\t\tself._tick();\n\t\t});\n\n\t\tif (this.options.autoSetHeight) {\n\t\t\tthis._addResizeListener();\n\t\t}\n\t}\n};\n\n/**\n * Stop animation loop\n */\nproto.stopAnimating = function () {\n\tif (this.animationFrame) {\n\t\twindow.cancelAnimationFrame(this.animationFrame);\n\t\tthis.animationFrame = null;\n\n\t\tthis._removeResizeListener();\n\t}\n};\n\n/**\n * Redraw frame\n *\n * When resizing\n */\nproto.redraw = function () {\n\tthis._draw();\n};\n\n/**\n * Get canvas offset from mouse event\n */\nproto.offsetFromEvent = function (e) {\n\tvar elem = this.element;\n\tvar x = elem.offsetLeft;\n\tvar y = elem.offsetTop;\n\n\twhile (elem = elem.offsetParent) {\n\t\tx += elem.offsetLeft;\n\t\ty += elem.offsetTop;\n\t}\n\n\tvar offset = new T.Vector(x, y);\n\tvar scale = this.element.offsetWidth / this.element.width;\n\n\tif (!e.changedTouches) {\n\t\tvar docElem = document.documentElement;\n\n\t\toffset.x = e.clientX - offset.x + docElem.scrollLeft;\n\t\toffset.y = e.clientY - offset.y + docElem.scrollTop;\n\t}\n\t// is touch event\n\telse {\n\t\toffset.x = e.changedTouches[0].pageX - offset.x;\n\t\toffset.y = e.changedTouches[0].pageY - offset.y;\n\t}\n\n\toffset = offset.mult(1.0 / scale);\n\n\treturn offset;\n};\n\n/**\n * Get world position from relative pixel offset\n */\nproto.worldPositionFromOffset = function (offset) {\n\treturn this.inverseTransform.multVec(offset);\n};\n\n/**\n * Get relative pixel offset from world position\n */\nproto.offsetFromWorldPosition = function (offset) {\n\treturn this.transform.multVec(offset);\n};\n/**\n * Window resize handler\n */\nproto._resizeEventHandler = null;\n\n/**\n * Add event listeners for window resize\n */\nproto._addResizeListener = function () {\n\tvar self = this;\n\n\tif (!this._resizeEventHandler) {\n\t\tthis._resizeEventHandler = function () {\n\t\t\tvar parentNode = self.element.parentNode;\n\t\t\tvar rect = parentNode.getBoundingClientRect();\n\t\t\tvar ratio = self.element.height / self.element.width;\n\n\t\t\tself.element.style.height = parseInt(rect.width * ratio) + 'px';\n\t\t};\n\n\t\twindow.addEventListener('resize', this._resizeEventHandler);\n\t\twindow.addEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler();\n\t}\n};\n\n/**\n * Remove event listeners for window resize\n */\nproto._removeResizeListener = function () {\n\tif (this._resizeEventHandler) {\n\t\twindow.removeEventListener('resize', this._resizeEventHandler);\n\t\twindow.removeEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler = null;\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend point-mass.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Defines a constraint between two point masses\n *\n * Keeps the points `p1` and `p1` at a given resting distance `restDist`\n * A `stiffness` value of 1.0 sets the maximum responsiveness\n * Values below 1.0 and above 0.0 make the constraint more \"rubbery\"\n *\n * If `restDist` is omitted, it is set to the initial distance\n *   between `p1` and `p2`\n * If `stiffness` is omitted, it is set to its maximum value 1.0\n */\nvar Constraint = T.Constraint = function (p1, p2, restDist, stiffness) {\n\t// set current distance as resting distance if not defined\n\tif (restDist === undefined) {\n \t\trestDist = p2.p.sub(p1.p).length();\n\t}\n\n\t// set default stiffness to maximum if not defined\n\tif (stiffness === undefined) {\n\t\tstiffness = 1.0;\n\t}\n\n\t// set controlling points\n\tthis.p1 = p1;\n\tthis.p2 = p2;\n\n\t// set resting distance\n\tthis.restDist = restDist;\n\n\t// set stiffness\n\tthis.stiffness = stiffness;\n}\n\nvar proto = Constraint.prototype;\n\n/**\n * Solve step\n */\nproto.solve = function() {\n\tvar p1 = this.p1;\n\tvar p2 = this.p2;\n\n\t// current distance vector between points\n\t// d = p1 - p2\n\tvar d = p1.p.sub(p2.p);\n\n\t// scalar distance between points\n\t// l = |d|\n\tvar l = d.length();\n\n\tvar r = 0.0;\n\n\t// proportion between current distance and resting distance\n\tif (l != 0.0) {\n\t\tr = (this.restDist - l) / l;\n\t}\n\n\t// distance vector differing from resting distance\n\t// d *= r\n\td = d.mult(r);\n\n\t// mass influence of `p1` as fraction between 0.0 and 1.0\n\t// `0.5` would mean that `p1` and `p2` have the same mass\n\tvar f1 = 1.0 - p1.mass / (p1.mass + p2.mass);\n\n\t// influences of `p1` and `p2`\n\tvar s1 = f1 * this.stiffness;\n\tvar s2 = this.stiffness - s1;\n\n\tif (!p1.pinned) {\n\t\t// p1 += d * s1\n\t\tp1.p = p1.p.add(d.mult(s1));\n\t}\n\n\tif (!p2.pinned) {\n\t\t// p2 -= d * s2\n\t\tp2.p = p2.p.sub(d.mult(s2));\n\t}\n};\n\n}(Tetragon));\n"]}