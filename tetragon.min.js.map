{"version":3,"sources":["tetragon.js"],"names":["w","lastTime","vendors","x","length","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","Date","getTime","timeToCall","Math","max","id","setTimeout","clearTimeout","window","Tetragon","version","T","Vector","y","this","parseFloat","proto","prototype","add","vec","sub","inc","dec","shl","n","shr","integ","mult","fac","div","sqrt","lengthSquared","normalize","undefined","len","multVec","divVec","dot","reflect","wall","negate","copy","rotate","a","r","PI","c","cos","s","sin","AnimationLoop","framerate","advanceToTime","time","tickFunc","Controls","keys","LEFT","TOP","RIGHT","BOTTOM","keyMap",37,38,39,40,65,87,68,83,"pressKeyWithCode","keyCode","releaseKeyWithCode","isKeyPressed","key","reset","EntityComponent","options","name","createInstance","data","iterate","func","i","args","Array","slice","call","arguments","hasOwnProperty","apply","EntitySystem","entities","freeEntites","components","namedComponents","component","createComponent","push","entity","Entity","createEntity","pop","unshift","system","addComponent","instance","removeComponent","componentData","mask","extend","obj","obj2","j","arg","reduce","items","initValue","value","loadImages","images","waitForLoad","src","image","Image","onload","loadedImgs","load","loadCount","done","Object","Matrix","values","set","translate","scale","m","multiply","mat","invert","det","setContextTransform","ctx","setTransform","PointMass","position","mass","p","pp","invMass","Number","MAX_VALUE","damping","pinned","inertia","dt","dtf","v","applyForce","force","pin","Range","start","defineProperty","enumerable","get","end","containsPoint","point","containsRange","range","intersectsWithRange","Rect","pos","size","maxPos","containsRect","rect","rectPos","rectMaxPos","intersectsWithRect","TRANSFORM_UPDATED","AUTO_CLEAR","Canvas","tick","draw","autoClear","origin","autoSetHeight","test","navigator","userAgent","getContext","animationLoop","_viewport","_transform","_inverseTrans","_flags","width","height","transform","viewport","_updateTransform","_tick","self","info","deltaTime","frameDelta","_draw","animationFrame","clear","save","clearRect","restore","startAnimating","_addResizeListener","stopAnimating","_removeResizeListener","redraw","offsetFromEvent","e","elem","offsetLeft","offsetTop","offsetParent","offset","offsetWidth","changedTouches","pageX","pageY","docElem","document","documentElement","clientX","scrollLeft","clientY","scrollTop","worldPositionFromOffset","inverseTransform","offsetFromWorldPosition","_resizeEventHandler","parentNode","getBoundingClientRect","ratio","style","parseInt","addEventListener","removeEventListener","Constraint","p1","p2","restDist","stiffness","solve","d","l","f1","s1","s2"],"mappings":"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","file":"tetragon.min.js","sourcesContent":["/**\n * Polyfill for window.requestAnimationFrame\n *\n * http://www.paulirish.com/2011/requestanimationframe-for-smart-animating/\n */\n(function (w) {\n\tvar lastTime = 0;\n\tvar vendors = ['webkit', 'moz'];\n\tfor(var x = 0; x < vendors.length && !w.requestAnimationFrame; ++x) {\n\t\tw.requestAnimationFrame = w[vendors[x]+'RequestAnimationFrame'];\n\t\tw.cancelAnimationFrame =\n\t\t  w[vendors[x]+'CancelAnimationFrame'] || w[vendors[x]+'CancelRequestAnimationFrame'];\n\t}\n\n\tif (!w.requestAnimationFrame)\n\t\tw.requestAnimationFrame = function (callback, element) {\n\t\t\tvar currTime = new Date().getTime();\n\t\t\tvar timeToCall = Math.max(0, 16 - (currTime - lastTime));\n\t\t\tvar id = w.setTimeout(function () { callback(currTime + timeToCall); }, timeToCall);\n\t\t\tlastTime = currTime + timeToCall;\n\t\t\treturn id;\n\t\t};\n\n\tif (!w.cancelAnimationFrame)\n\t\tw.cancelAnimationFrame = function (id) {\n\t\t\tclearTimeout(id);\n\t\t};\n}(window));\n\n(function (w) {\n'use strict';\n\nw.Tetragon = w.Tetragon || {};\n\nw.Tetragon.version = '0.1.0';\n\n}(window));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Vector = T.Vector = function (x, y) {\n\tthis.x = parseFloat(x) || 0.0;\n\tthis.y = parseFloat(y) || 0.0;\n};\n\nvar proto = Vector.prototype;\n\nproto.add = function (vec) {\n\treturn new Vector(this.x + vec.x, this.y + vec.y);\n};\n\nproto.sub = function (vec) {\n\treturn new Vector(this.x - vec.x, this.y - vec.y);\n};\n\nproto.inc = function (vec) {\n\tthis.x += vec.x;\n\tthis.y += vec.y;\n};\n\nproto.dec = function (vec) {\n\tthis.x -= vec.x;\n\tthis.y -= vec.y;\n};\n\nproto.shl = function (n) {\n\treturn new Vector(\n\t\tthis.x << n,\n\t\tthis.y << n\n\t);\n};\n\nproto.shr = function (n) {\n\treturn new Vector(\n\t\tthis.x >> n,\n\t\tthis.y >> n\n\t);\n};\n\nproto.integ = function (n) {\n\treturn new Vector(\n\t\tthis.x | 0,\n\t\tthis.y | 0\n\t);\n};\n\nproto.mult = function (fac) {\n\treturn new Vector(this.x * fac, this.y * fac);\n};\n\nproto.div = function (fac) {\n\treturn new Vector(this.x / fac, this.y / fac);\n};\n\nproto.length = function () {\n\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n};\n\nproto.lengthSquared = function () {\n\treturn this.x * this.x + this.y * this.y;\n};\n\nproto.normalize = function (length) {\n\tif (length === undefined) {\n\t\tlength = 1.0;\n\t}\n\n\tvar x   = this.x;\n\tvar y   = this.y;\n\tvar len = this.length();\n\n\tif (len) {\n\t\tlen = length / len;\n\t}\n\n\tx *= len;\n\ty *= len;\n\n\treturn new Vector(x, y);\n};\n\nproto.multVec = function (vec) {\n\treturn new Vector(this.x * vec.x, this.y * vec.y);\n};\n\nproto.divVec = function (vec) {\n\treturn new Vector(this.x / vec.x, this.y / vec.y);\n};\n\nproto.dot = function (vec) {\n\treturn this.x * vec.x + this.y * vec.y;\n};\n\nproto.reflect = function (wall) {\n\twall = wall.normalize();\n\treturn this.sub(wall.mult(2.0 * wall.dot(this)));\n};\n\nproto.negate = function (wall) {\n\treturn new Vector(-this.x, -this.y);\n};\n\nproto.copy = function () {\n\treturn new Vector(this.x, this.y);\n};\n\nproto.rotate = function (a) {\n\tvar r = a / 180.0 * Math.PI;\n\tvar c = Math.cos(r);\n\tvar s = Math.sin(r);\n\n\tvar x = this.x * c - this.y * s;\n\tvar y = this.x * s + this.y * c;\n\n\treturn new Vector(x, y);\n};\n\nproto.copy = function (a) {\n\treturn new Vector(this.x, this.y);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Animation loop\n */\nvar AnimationLoop = T.AnimationLoop = function (framerate) {\n\tthis.framerate = framerate;\n\tthis.lastTime  = 0;\n}\n\nvar proto = AnimationLoop.prototype;\n\n/**\n * Advance animation loop to new time\n *\n * `tickFunc` is called every frame\n */\nproto.advanceToTime = function (time, tickFunc) {\n\t// set `lastTime` to previous frame if first frame\n\tif (this.lastTime == 0) {\n\t\tthis.lastTime = time - 1.0 / 60.0;\n\t}\n\n\t// limit previous time if animation was paused or had a greater lag,\n\t// the loop will not try to catch up with a too big time step\n\tthis.lastTime = Math.max(time - 1.0 / 20.0, this.lastTime)\n\n\t// only advance to previous frame\n\ttime -= this.framerate;\n\n\t// advance to new time\n\twhile (this.lastTime < time) {\n\t\ttickFunc(this.framerate);\n\t\tthis.lastTime += this.framerate;\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar Controls = T.Controls = function () {\n\tthis.keys = 0;\n};\n\nControls.LEFT   = 1 << 0;\nControls.TOP    = 1 << 1;\nControls.RIGHT  = 1 << 2;\nControls.BOTTOM = 1 << 3;\n\nControls.keyMap = {\n\t37: Controls.LEFT,   // arrow left\n\t38: Controls.TOP,    // arrow up\n\t39: Controls.RIGHT,  // arrow right\n\t40: Controls.BOTTOM, // arrow down\n\n\t65: Controls.LEFT,   // A\n\t87: Controls.TOP,    // W\n\t68: Controls.RIGHT,  // D\n\t83: Controls.BOTTOM  // S\n};\n\nvar proto = Controls.prototype;\n\nproto.pressKeyWithCode = function (keyCode) {\n\tif (Controls.keyMap[keyCode]) {\n\t\tthis.keys |= Controls.keyMap[keyCode];\n\t}\n};\n\nproto.releaseKeyWithCode = function (keyCode) {\n\tif (Controls.keyMap[keyCode]) {\n\t\tthis.keys &= ~Controls.keyMap[keyCode];\n\t}\n};\n\nproto.isKeyPressed = function (key) {\n\treturn this.keys & key;\n};\n\nproto.reset = function () {\n\tthis.keys = 0;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntityComponent = T.EntityComponent = function (id, options) {\n\tthis.id = id;\n\tthis.name = options.name;\n\tthis.options = options;\n\tthis.createInstance = options.createInstance;\n\tthis.data = [];\n};\n\nvar proto = EntityComponent.prototype;\n\n/**\n * Iterate entity component data\n *\n * If `func` is a callback, it will be called with the entity component data as\n * first argument followed by all arguments given to this function.\n * If `func` is a string, the corresponding callback of the component is used.\n */\nproto.iterate = function (func) {\n\tvar i;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof func == 'string') {\n\t\tfunc = this.options[func];\n\t}\n\n\tfor (i in this.data) {\n\t\tif (this.data.hasOwnProperty(i)) {\n\t\t\tfunc.apply(this.data[i], args);\n\t\t}\n\t}\n\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar EntitySystem = T.EntitySystem = function () {\n\tthis.entities = [];\n\tthis.freeEntites = [];\n\tthis.components = [];\n\tthis.namedComponents = {};\n};\n\nvar proto = EntitySystem.prototype;\n\nproto.component = function (name) {\n\treturn this.namedComponents[name];\n};\n\nproto.createComponent = function (options) {\n\tvar id = this.components.length;\n\tvar component = new T.EntityComponent(id, options);\n\tthis.components.push(component);\n\tthis.namedComponents[component.name] = component;\n\n\treturn component;\n};\n\nproto.entity = function (id) {\n\tif (this.entities[id] === undefined) {\n\t\treturn null;\n\t}\n\n\treturn new Entity(id, this);\n};\n\nproto.createEntity = function () {\n\tvar id = this.freeEntites.pop();\n\n\tif (id === undefined) {\n\t\tid = this.entities.length + 1;\n\t\tthis.entities.push(0);\n\t}\n\n\treturn new T.Entity(id, this);\n};\n\nproto.iterate = function (name, func) {\n\tvar args = Array.prototype.slice.call(arguments, 2);\n\tvar component = this.component(name);\n\n\tif (component) {\n\t\targs.unshift(func);\n\t\tcomponent.iterate.apply(component, args);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend entity-system.js\n * @depend entity-component.js\n */\n\n(function (T) {\n'use strict';\n\nvar Entity = T.Entity = function (id, system) {\n\tthis.id = id;\n\tthis.system = system;\n};\n\nvar proto = Entity.prototype;\n\nproto.addComponent = function (component) {\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tif (typeof(component) == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tvar instance;\n\n\tif (component.createInstance) {\n\t\tinstance = component.createInstance.apply(this, args);\n\t}\n\telse {\n\t\tinstance = {};\n\t}\n\n\tinstance.entity = this;\n\tcomponent.data[this.id - 1] = instance;\n\tthis.system.entities[this.id - 1] |= (1 << component.id);\n\n\treturn instance;\n};\n\nproto.removeComponent = function (component) {\n\tif (typeof(component) == 'string') {\n\t\tcomponent = this.system.component(component);\n\n\t\tif (!component) {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tif (!component.data[this.id - 1]) {\n\t\treturn null;\n\t}\n\n\tdelete component.data[this.id - 1];\n\tthis.system.entities[this.id - 1] &= ~(1 << component.id);\n\n\treturn instance;\n};\n\nproto.componentData = function (name) {\n\tvar component = this.system.namedComponents[name];\n\n\tif (!component) {\n\t\treturn null;\n\t}\n\n\treturn component.data[this.id - 1];\n};\n\nproto.delete = function () {\n\tvar n = 0;\n\tvar system = this.system;\n\n\tif (system.entities[this.id - 1] === undefined) {\n\t\treturn;\n\t}\n\n\tvar mask = system.entities[this.id - 1];\n\n\twhile (mask) {\n\t\tif (!(mask & 0xFF)) {\n\t\t\tmask >>= 8;\n\t\t\tn += 8;\n\t\t}\n\n\t\tif (mask & 1) {\n\t\t\tvar component = system.components[n];\n\t\t\tdelete component.data[this.id - 1];\n\t\t}\n\n\t\tmask >>= 1;\n\t\tn ++;\n\t}\n\n\tdelete system.entities[this.id - 1];\n\tsystem.freeEntites.push(this.id);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n */\n\n(function (T) {\n'use strict';\n\nT.extend = function (obj, obj2) {\n\tvar i, j;\n\tvar arg;\n\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\tfor (i = 0; i < args.length; i ++) {\n\t\tvar arg = args[i];\n\n\t\tfor (j in arg) {\n\t\t\tif (arg.hasOwnProperty(j)) {\n\t\t\t\tif (arg[j] !== null && arg[j] !== undefined) {\n\t\t\t\t\tobj[j] = arg[j];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn obj;\n};\n\nT.reduce = function (items, initValue, reduce) {\n\tvar i;\n\tvar value = initValue;\n\n\tfor (i = 0; i < items.length; i ++) {\n\t\tvalue = reduce(value, items[i]);\n\t}\n\n\treturn value;\n};\n\nT.loadImages = function (images, options) {\n\tvar i;\n\tvar keys;\n\tvar options    = options || {};\n\tvar loadCount  = 0;\n\tvar loadedImgs = {};\n\n\tfunction waitForLoad(src, key) {\n\t\tvar image = new Image();\n\n\t\timage.onload = function () {\n\t\t\tif (!loadedImgs[key]) {\n\t\t\t\tloadedImgs[key] = image;\n\n\t\t\t\tif (options.load) {\n\t\t\t\t\toptions.load(image);\n\t\t\t\t}\n\n\t\t\t\tif (++ loadCount >= keys.length) {\n\t\t\t\t\tif (options.done) {\n\t\t\t\t\t\toptions.done(loadedImgs);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\timage.src = src;\n\n\t\treturn image;\n\t}\n\n\toptions = T.extend({\n\t\tdone: null,\n\t\tload: null\n\t}, options);\n\n\tkeys = Object.keys(images);\n\n\tif (keys.length == 0) {\n\t\tif (options.done) {\n\t\t\toptions.done(loadedImgs);\n\t\t}\n\t}\n\n\tfor (i = 0; i < keys.length; i ++) {\n\t\tvar key = keys[i];\n\t\tvar src = images[key];\n\n\t\t// assuming an image element\n\t\tif (src === Object(src)) {\n\t\t\tsrc = src.src;\n\t\t}\n\n\t\twaitForLoad(src, key);\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Matrix = T.Matrix = function (values) {\n\tif (values) {\n\t\tthis.set(values);\n\t}\n\telse {\n\t\tthis.set([\n\t\t\t1, 0,\n\t\t\t0, 1,\n\t\t\t0, 0,\n\t\t]);\n\t}\n};\n\nvar proto = Matrix.prototype;\n\nproto.translate = function (vec) {\n\tthis[4] += vec.x * this[0] + vec.y * this[2];\n\tthis[5] += vec.x * this[1] + vec.y * this[3];\n\n\treturn this;\n};\n\nproto.scale = function (vec) {\n\tthis[0] *= vec.x;\n\tthis[2] *= vec.x;\n\tthis[1] *= vec.y;\n\tthis[3] *= vec.y;\n\n\treturn this;\n};\n\nproto.rotate = function (a) {\n\tvar s, c;\n\n\ta = a / 180.0 * Math.PI;\n\ts = Math.sin(a);\n\tc = Math.cos(a);\n\n\tvar m = this.multiply(new T.Matrix([\n\t\tc, s,\n\t\t-s, c,\n\t\t0, 0,\n\t]));\n\n\tthis.set(m);\n\n\treturn this;\n};\n\nproto.multVec = function (vec) {\n\treturn new T.Vector(\n\t\tthis[0] * vec.x + this[2] * vec.y + this[4],\n\t\tthis[1] * vec.x + this[3] * vec.y + this[5]\n\t);\n};\n\nproto.multiply = function (mat) {\n\treturn new Matrix([\n\t\tthis[0] * mat[0] + this[2] * mat[1],\n\t\tthis[1] * mat[0] + this[3] * mat[1],\n\t\tthis[0] * mat[2] + this[2] * mat[3],\n\t\tthis[1] * mat[2] + this[3] * mat[3],\n\t\tthis[0] * mat[4] + this[2] * mat[5] + this[4],\n\t\tthis[1] * mat[4] + this[3] * mat[5] + this[5]\n\t]);\n};\n\nproto.invert = function () {\n\tvar det;\n\tvar mat = new T.Matrix();\n\n\tmat[0] =  this[3];\n\tmat[1] = -this[1];\n\tmat[2] = -this[2];\n\tmat[3] =  this[0];\n\tmat[4] =  this[2] * this[5] - this[3] * this[4];\n\tmat[5] = -this[0] * this[5] + this[1] * this[4];\n\n\tdet = this[0] * mat[0] + this[2] * mat[1];\n\n\tif (det == 0.0) {\n\t\treturn this.copy();\n\t}\n\n\tdet = 1.0 / det;\n\n\tmat[0] *= det;\n\tmat[1] *= det;\n\tmat[2] *= det;\n\tmat[3] *= det;\n\tmat[4] *= det;\n\tmat[5] *= det;\n\n\treturn mat;\n};\n\nproto.copy = function () {\n\treturn new T.Matrix(this);\n};\n\nproto.set = function (mat) {\n\tthis[0] = mat[0];\n\tthis[1] = mat[1];\n\tthis[2] = mat[2];\n\tthis[3] = mat[3];\n\tthis[4] = mat[4];\n\tthis[5] = mat[5];\n\n\treturn this;\n};\n\nproto.setContextTransform = function (ctx) {\n\tctx.setTransform(this[0], this[1], this[2], this[3], this[4], this[5]);\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Defines a point mass\n *\n * The point is initialized with an initial `position` and a `mass`\n * More mass means more inertness\n */\nvar PointMass = T.PointMass = function (position, mass) {\n\t// current position\n\tthis.p = position.copy();\n\n\t// previous position\n\tthis.pp = position.copy();\n\n\t// acceleration for current frame\n\tthis.a = new T.Vector(); // null vector\n\n\t// mass; set to 1.0 if not defined\n\tthis.mass = mass ||Â 1.0;\n\n\t// inverse mass\n\tif (this.mass == 0.0) {\n\t\tthis.invMass = Number.MAX_VALUE;\n\t}\n\telse if (this.mass == Number.MAX_VALUE) {\n\t\tthis.invMass = 0.0;\n\t}\n\telse {\n\t\tthis.invMass = 1.0 / this.mass;\n\t}\n\n\t// set default damping value\n\tthis.damping = 0.997;\n\n\t// `true` if pinned to current position\n\tthis.pinned = false;\n};\n\nvar proto = PointMass.prototype;\n\n/**\n * Move point to next position\n */\nproto.inertia = function(dt) {\n\t// time depending factor used for acceleration\n\t// dtf = 0.5 * dt^2\n\tvar dtf = 0.5 * dt * dt;\n\n\t// get velocity vector and add damping\n\t// v = (p - pp) * damping\n\tvar v = this.p.sub(this.pp).mult(this.damping);\n\n\t// this is more accurate, but also slower\n\t// v = (p - pp) * damping ^ dt\n\t//var v = this.p.sub(this.pp).mult(Math.pow(this.damping, dt));\n\n\t// calculate next position by adding velocity\n\t// and acceleration to current position\n\t// n = p + v + a * dtf\n\tvar n = this.p.add(v.add(this.a.mult(dtf)));\n\n\t// set previous position to current position\n\tthis.pp = this.p.copy();\n\n\t// set current position to next position\n\tthis.p = n;\n\n\t// clear acceleration for current step\n\tthis.a = new T.Vector();\n};\n\n/**\n * Add force vector\n */\nproto.applyForce = function(force) {\n\t// add force multiplied with inverse of mass\n\t// a += force * (1.0 / mass)\n\tthis.a = this.a.add(force.mult(this.invMass));\n};\n\n/**\n * Pin point to its current position\n */\nproto.pin = function() {\n\tthis.pp     = this.p.copy();\n\tthis.pinned = true;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Range = T.Range = function (start, length) {\n\tthis.start = start || 0;\n\tthis.length = length || 0;\n\n};\n\nvar proto = Range.prototype;\n\nObject.defineProperty(proto, 'end', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.start + this.length;\n\t},\n\tset: function (end) {\n\t\tthis.length = end - this.start;\n\t}\n});\n\nproto.containsPoint = function (point) {\n\treturn point >= this.start && point < this.end;\n};\n\nproto.containsRange = function (range) {\n\treturn range.start >= this.start && range.end <= this.end;\n};\n\nproto.intersectsWithRange = function (range) {\n\treturn range.start < this.end && range.end > this.start;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend vector.js\n */\n\n(function (T) {\n'use strict';\n\nvar Rect = T.Rect = function (p, s) {\n\tthis.pos  = p ? p.copy() : new T.Vector();\n\tthis.size = s ? s.copy() : new T.Vector();\n};\n\nvar proto = Rect.prototype;\n\nObject.defineProperty(proto, 'maxPos', {\n\tenumerable: true,\n\tget: function () {\n\t\treturn this.pos.add(this.size);\n\t},\n\tset: function (maxPos) {\n\t\tthis.size = maxPos.sub(this.size);\n\t}\n});\n\nproto.containsPoint = function (point) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\n\tif (point.x >= pos.x && point.x < maxPos.x) {\n\t\tif (point.y >= pos.y && point.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.containsRect = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectPos.x >= pos.x && rectMaxPos.x < maxPos.x) {\n\t\tif (rectPos.y >= pos.y && rectMaxPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nproto.intersectsWithRect = function (rect) {\n\tvar pos = this.pos;\n\tvar maxPos = this.maxPos;\n\tvar rectPos = rect.pos;\n\tvar rectMaxPos = rect.maxPos;\n\n\tif (rectMaxPos.x > pos.x && rectPos.x < maxPos.x) {\n\t\tif (rectMaxPos.y > pos.y && rectPos.y < maxPos.y) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend animation-loop.js\n * @depend vector.js\n * @depend matrix.js\n */\n\n(function (T) {\n'use strict';\n\nvar TRANSFORM_UPDATED = 1 << 0;\nvar AUTO_CLEAR        = 1 << 1;\n\n/**\n * Encapsulates canvas animation\n */\nvar Canvas = T.Canvas = function (options) {\n\toptions = T.extend({\n\t\telement: null,\n\t\ttick: function () {},\n\t\tdraw: function () {},\n\t\tframerate: 1.0 / 120.0,\n\t\tautoClear: true,\n\t\torigin: new T.Vector(0.5, 0.5),\n\t\tscale: null,\n\t\tautoSetHeight: /MSIE/.test(navigator.userAgent), // IE 10 and below\n\t}, options);\n\n\tthis.element       = options.element;\n\tthis.ctx           = options.element.getContext('2d');\n\tthis.tick          = options.tick;\n\tthis.draw          = options.draw;\n\tthis.framerate     = options.framerate;\n\tthis.animationLoop = new T.AnimationLoop(this.framerate);\n\tthis._viewport     = new T.Rect();\n\tthis._transform    = null;\n\tthis._inverseTrans = null;\n\tthis._flags        = 0;\n\tthis.options       = options;\n\n\tif (options.autoClear) {\n\t\tthis._flags |= AUTO_CLEAR;\n\t}\n};\n\nvar proto = Canvas.prototype;\n\nObject.defineProperty(proto, 'viewport', {\n\tget: function () {\n\t\tvar element = this.element;\n\t\tvar width   = +element.width;\n\t\tvar height  = +element.height;\n\n\t\tthis._viewport.size.x = width;\n\t\tthis._viewport.size.y = height;\n\n\t\treturn this._viewport;\n\t}\n});\n\nObject.defineProperty(proto, 'transform', {\n\tget: function () {\n\t\tvar transform = this._transform;\n\n\t\tif (!transform) {\n\t\t\ttransform = new T.Matrix();\n\n\t\t\tif (this.options.origin) {\n\t\t\t\ttransform.translate(this.options.origin.multVec(this.viewport.size));\n\t\t\t}\n\n\t\t\tif (this.options.scale) {\n\t\t\t\ttransform.scale(this.options.scale);\n\t\t\t}\n\t\t}\n\n\t\treturn transform;\n\t},\n\tset: function (transform) {\n\t\tif (transform) {\n\t\t\ttransform = transform.copy()\n\t\t}\n\n\t\tthis._transform = transform;\n\t\tthis._transform.setContextTransform(this.ctx);\n\t\tthis._flags |= TRANSFORM_UPDATED;\n\t}\n});\n\nObject.defineProperty(proto, 'inverseTransform', {\n\tget: function () {\n\t\tif (this._flags & TRANSFORM_UPDATED || !this._inverseTrans) {\n\t\t\tthis._inverseTrans = this.transform.invert();\n\t\t\tthis._flags &= ~TRANSFORM_UPDATED;\n\t\t}\n\n\t\treturn this._inverseTrans.copy();\n\t}\n});\n\nproto._updateTransform = function (transform) {\n\ttransform = transform || this.transform;\n\ttransform.setContextTransform(this.ctx);\n};\n\n/**\n * Advance time\n */\nproto._tick = function () {\n\tvar self = this;\n\tvar time = (new Date()).getTime() / 1000;\n\tvar info = {viewport: self.viewport};\n\n\tif (this.framerate) {\n\t\tthis.animationLoop.advanceToTime(time, function () {\n\t\t\tinfo.deltaTime = self.framerate;\n\t\t\tself.tick(self.framerate, info);\n\t\t});\n\t}\n\t// link framerate to draw rate\n\telse {\n\t\tvar dt = 0;\n\n\t\tif (this.animationLoop.lastTime == 0) {\n\t\t\tdt = time - 1.0 / 60.0;\n\t\t}\n\t\telse {\n\t\t\tdt = time - this.animationLoop.lastTime;\n\t\t}\n\n\t\tinfo.deltaTime = dt;\n\t\tself.tick(dt, info);\n\n\t\tthis.animationLoop.lastTime = time;\n\t}\n\n\tif (this.animationLoop.framerate) {\n\t\tinfo.frameDelta = time - this.animationLoop.lastTime;\n\t}\n\telse {\n\t\tinfo.frameDelta = 0;\n\t}\n\n\tthis._draw(info);\n\n\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\tself._tick();\n\t});\n};\n\nproto.clear = function () {\n\tvar transform;\n\tvar size   = this.viewport.size;\n\tvar width  = size.x;\n\tvar height = size.y;\n\n\tthis.ctx.save();\n\n\tthis._updateTransform(new T.Matrix());\n\tthis.ctx.clearRect(0, 0, width, height);\n\tthis._updateTransform();\n\n\tthis.ctx.restore();\n};\n\n/**\n * Draw frame\n */\nproto._draw = function (info) {\n\tif (this._flags & AUTO_CLEAR) {\n\t\tthis.clear();\n\t}\n\n\tthis.ctx.save();\n\tthis._updateTransform();\n\n\tthis.draw.call(this, this.ctx, info);\n\n\tthis.ctx.restore();\n};\n\n/**\n * Start animation loop\n */\nproto.startAnimating = function () {\n\tvar self = this;\n\n\tif (!this.animationFrame) {\n\t\tthis.animationFrame = window.requestAnimationFrame(function () {\n\t\t\tself._tick();\n\t\t});\n\n\t\tif (this.options.autoSetHeight) {\n\t\t\tthis._addResizeListener();\n\t\t}\n\t}\n};\n\n/**\n * Stop animation loop\n */\nproto.stopAnimating = function () {\n\tif (this.animationFrame) {\n\t\twindow.cancelAnimationFrame(this.animationFrame);\n\t\tthis.animationFrame = null;\n\n\t\tthis._removeResizeListener();\n\t}\n};\n\n/**\n * Redraw frame\n *\n * When resizing\n */\nproto.redraw = function () {\n\tthis._draw();\n};\n\n/**\n * Get canvas offset from mouse event\n */\nproto.offsetFromEvent = function (e) {\n\tvar elem = this.element;\n\tvar x = elem.offsetLeft;\n\tvar y = elem.offsetTop;\n\n\twhile (elem = elem.offsetParent) {\n\t\tx += elem.offsetLeft;\n\t\ty += elem.offsetTop;\n\t}\n\n\tvar offset = new T.Vector(x, y);\n\tvar scale = this.element.offsetWidth / this.element.width;\n\n\tif (!e.changedTouches) {\n\t\tvar docElem = document.documentElement;\n\n\t\toffset.x = e.clientX - offset.x + docElem.scrollLeft;\n\t\toffset.y = e.clientY - offset.y + docElem.scrollTop;\n\t}\n\t// is touch event\n\telse {\n\t\toffset.x = e.changedTouches[0].pageX - offset.x;\n\t\toffset.y = e.changedTouches[0].pageY - offset.y;\n\t}\n\n\toffset = offset.mult(1.0 / scale);\n\n\treturn offset;\n};\n\n/**\n * Get world position from relative pixel offset\n */\nproto.worldPositionFromOffset = function (offset) {\n\treturn this.inverseTransform.multVec(offset);\n};\n\n/**\n * Get relative pixel offset from world position\n */\nproto.offsetFromWorldPosition = function (offset) {\n\treturn this.transform.multVec(offset);\n};\n/**\n * Window resize handler\n */\nproto._resizeEventHandler = null;\n\n/**\n * Add event listeners for window resize\n */\nproto._addResizeListener = function () {\n\tvar self = this;\n\n\tif (!this._resizeEventHandler) {\n\t\tthis._resizeEventHandler = function () {\n\t\t\tvar parentNode = self.element.parentNode;\n\t\t\tvar rect = parentNode.getBoundingClientRect();\n\t\t\tvar ratio = self.element.height / self.element.width;\n\n\t\t\tself.element.style.height = parseInt(rect.width * ratio) + 'px';\n\t\t};\n\n\t\twindow.addEventListener('resize', this._resizeEventHandler);\n\t\twindow.addEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler();\n\t}\n};\n\n/**\n * Remove event listeners for window resize\n */\nproto._removeResizeListener = function () {\n\tif (this._resizeEventHandler) {\n\t\twindow.removeEventListener('resize', this._resizeEventHandler);\n\t\twindow.removeEventListener('orientationchange', this._resizeEventHandler);\n\t\tthis._resizeEventHandler = null;\n\t}\n};\n\n}(Tetragon));\n\n/**\n * @depend tetragon.js\n * @depend point-mass.js\n */\n\n(function (T) {\n'use strict';\n\n/**\n * Defines a constraint between two point masses\n *\n * Keeps the points `p1` and `p1` at a given resting distance `restDist`\n * A `stiffness` value of 1.0 sets the maximum responsiveness\n * Values below 1.0 and above 0.0 make the constraint more \"rubbery\"\n *\n * If `restDist` is omitted, it is set to the initial distance\n *   between `p1` and `p2`\n * If `stiffness` is omitted, it is set to its maximum value 1.0\n */\nvar Constraint = T.Constraint = function (p1, p2, restDist, stiffness) {\n\t// set current distance as resting distance if not defined\n\tif (restDist === undefined) {\n \t\trestDist = p2.p.sub(p1.p).length();\n\t}\n\n\t// set default stiffness to maximum if not defined\n\tif (stiffness === undefined) {\n\t\tstiffness = 1.0;\n\t}\n\n\t// set controlling points\n\tthis.p1 = p1;\n\tthis.p2 = p2;\n\n\t// set resting distance\n\tthis.restDist = restDist;\n\n\t// set stiffness\n\tthis.stiffness = stiffness;\n}\n\nvar proto = Constraint.prototype;\n\n/**\n * Solve step\n */\nproto.solve = function() {\n\tvar p1 = this.p1;\n\tvar p2 = this.p2;\n\n\t// current distance vector between points\n\t// d = p1 - p2\n\tvar d = p1.p.sub(p2.p);\n\n\t// scalar distance between points\n\t// l = |d|\n\tvar l = d.length();\n\n\tvar r = 0.0;\n\n\t// proportion between current distance and resting distance\n\tif (l != 0.0) {\n\t\tr = (this.restDist - l) / l;\n\t}\n\n\t// distance vector differing from resting distance\n\t// d *= r\n\td = d.mult(r);\n\n\t// mass influence of `p1` as fraction between 0.0 and 1.0\n\t// `0.5` would mean that `p1` and `p2` have the same mass\n\tvar f1 = 1.0 - p1.mass / (p1.mass + p2.mass);\n\n\t// influences of `p1` and `p2`\n\tvar s1 = f1 * this.stiffness;\n\tvar s2 = this.stiffness - s1;\n\n\tif (!p1.pinned) {\n\t\t// p1 += d * s1\n\t\tp1.p = p1.p.add(d.mult(s1));\n\t}\n\n\tif (!p2.pinned) {\n\t\t// p2 -= d * s2\n\t\tp2.p = p2.p.sub(d.mult(s2));\n\t}\n};\n\n}(Tetragon));\n"]}